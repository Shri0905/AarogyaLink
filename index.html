<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Aarogya Link - Professional anemia screening tool with progressive assessment">
  <meta name="theme-color" content="#607d8b">
  <title>Aarogya Link | Smart Anemia Screening</title>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-763YK30X5T"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-763YK30X5T');
    
    // Global error tracking
    window.addEventListener('error', function(e) {
      gtag('event', 'exception', {
        'description': (e.error && e.error.message) ? e.error.message : 'Unknown error',
        'fatal': false
      });
      console.error('Global error:', e);
    });

    window.addEventListener('unhandledrejection', function(e) {
      gtag('event', 'exception', {
        'description': (e.reason && e.reason.message) ? e.reason.message : 'Unhandled promise rejection',
        'fatal': false
      });
      console.error('Unhandled rejection:', e);
    });
  </script>

  <style>
    * {box-sizing:border-box;}
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #e8eaf6 0%, #f5f5f5 100%);
      margin:0; padding:0;
      min-height:100vh;
      line-height:1.6;
    }
    
    header {
      background: linear-gradient(135deg, #455a64 0%, #607d8b 100%);
      color:white; padding:20px; text-align:center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    header h1 {
      margin:0 0 8px 0; 
      font-size:clamp(22px, 5vw, 32px); 
      font-weight:600;
    }
    header p {
      margin:4px 0; 
      opacity:0.95; 
      font-size:clamp(13px, 3vw, 16px);
    }
    
    .lang-toggle {
      margin-top:16px;
      display:flex;
      gap:8px;
      justify-content:center;
      flex-wrap:wrap;
    }
    .lang-btn {
      padding:8px 16px;
      border:2px solid rgba(255,255,255,0.3);
      background:rgba(255,255,255,0.1);
      color:white;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
      transition:all 0.3s;
      font-weight:500;
    }
    .lang-btn:hover {
      background:rgba(255,255,255,0.2);
      transform:translateY(-2px);
    }
    .lang-btn.active {
      background:white;
      color:#607d8b;
      border-color:white;
    }
    
    .container {
      max-width:900px; 
      margin:auto; 
      padding:16px;
    }
    
    .card {
      background:white; 
      padding:clamp(20px, 4vw, 32px); 
      margin-top:20px;
      border-radius:16px; 
      box-shadow:0 8px 24px rgba(0,0,0,0.12);
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-3px);
    }
    
    .card h2 {
      margin-top:0;
      color:#455a64;
      font-size:clamp(18px, 4vw, 24px);
      border-bottom:3px solid #607d8b;
      padding-bottom:10px;
      margin-bottom:20px;
    }
    
    .progress-bar {
      width:100%;
      height:8px;
      background:#e0e0e0;
      border-radius:4px;
      overflow:hidden;
      margin:20px 0;
    }
    .progress-fill {
      height:100%;
      background: linear-gradient(90deg, #4caf50 0%, #66bb6a 100%);
      transition:width 0.4s ease;
      border-radius:4px;
    }
    .progress-text {
      text-align:center;
      color:#666;
      font-size:14px;
      margin-top:8px;
    }
    
    .question-container {
      min-height:300px;
      animation: fadeIn 0.4s ease;
    }
    @keyframes fadeIn {
      from {opacity:0; transform:translateX(20px);}
      to {opacity:1; transform:translateX(0);}
    }
    
    .question-text {
      font-size:clamp(16px, 3.5vw, 20px);
      font-weight:600;
      color:#333;
      margin-bottom:24px;
      line-height:1.5;
    }
    
    .visual-helper {
      background:#f5f5f5;
      padding:16px;
      border-radius:12px;
      margin:16px 0;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .visual-helper img {
      width:60px;
      height:60px;
      object-fit:contain;
    }
    .visual-helper-text {
      flex:1;
      font-size:14px;
      color:#666;
    }
    
    .food-gallery {
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(90px, 1fr));
      gap:12px;
      margin:16px 0;
      padding:16px;
      background:#f9f9f9;
      border-radius:12px;
    }
    .food-item {
      text-align:center;
      padding:10px;
      background:white;
      border-radius:10px;
      border:2px solid #e0e0e0;
      transition:all 0.3s;
      cursor:pointer;
    }
    .food-item:hover {
      transform:scale(1.05);
      border-color:#607d8b;
      box-shadow:0 4px 8px rgba(0,0,0,0.1);
    }
    .food-item img {
      width:100%;
      height:60px;
      object-fit:cover;
      border-radius:8px;
      margin-bottom:8px;
    }
    .food-item-name {
      font-size:11px;
      font-weight:600;
      color:#333;
      line-height:1.3;
    }
    
    .options-container {
      display:flex;
      flex-direction:column;
      gap:12px;
      margin:24px 0;
    }
    .option-btn {
      padding:16px 20px;
      border:2px solid #e0e0e0;
      background:white;
      border-radius:12px;
      cursor:pointer;
      transition:all 0.3s;
      font-size:16px;
      text-align:left;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .option-btn:hover {
      border-color:#607d8b;
      background:#f5f5f5;
      transform:translateX(5px);
    }
    .option-btn.selected {
      border-color:#607d8b;
      background:#e3f2fd;
      font-weight:600;
    }
    .option-icon {
      font-size:24px;
      min-width:30px;
    }
    
    .nav-buttons {
      display:flex;
      gap:12px;
      margin-top:24px;
    }
    .btn {
      flex:1;
      padding:14px 24px;
      border:none;
      border-radius:10px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      transition:all 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #546e7a 0%, #607d8b 100%);
      color:white;
      box-shadow: 0 4px 12px rgba(84,110,122,0.3);
    }
    .btn-primary:hover:not(:disabled) {
      transform:translateY(-2px);
      box-shadow: 0 6px 16px rgba(84,110,122,0.4);
    }
    .btn-secondary {
      background:#e0e0e0;
      color:#333;
    }
    .btn-secondary:hover {
      background:#d0d0d0;
    }
    .btn:disabled {
      opacity:0.5;
      cursor:not-allowed;
      transform:none !important;
    }
    
    .result-card {
      display:none;
      padding:28px;
      border-radius:16px;
      margin-top:24px;
      animation: slideIn 0.5s ease;
    }
    @keyframes slideIn {
      from {opacity:0; transform:translateY(20px);}
      to {opacity:1; transform:translateY(0);}
    }
    
    .high-risk {
      background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
      border-left:8px solid #ef5350;
    }
    .moderate-risk {
      background: linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%);
      border-left:8px solid #ffa726;
    }
    .low-risk {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border-left:8px solid #66bb6a;
    }
    
    .result-card h2 {
      margin-top:0;
      font-size:clamp(22px, 5vw, 28px);
      border:none;
      padding:0;
    }
    
    .next-steps {
      background:white;
      padding:24px;
      border-radius:12px;
      margin-top:20px;
    }
    .next-steps h3 {
      color:#455a64;
      margin-top:0;
      font-size:20px;
      border-bottom:2px solid #607d8b;
      padding-bottom:8px;
    }
    .next-steps ul {
      list-style:none;
      padding:0;
    }
    .next-steps li {
      padding:12px;
      margin:8px 0;
      background:#f5f5f5;
      border-radius:8px;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .next-steps li strong {
      color:#607d8b;
    }
    .next-steps a {
      color:#1976d2;
      text-decoration:none;
      font-weight:600;
    }
    .next-steps a:hover {
      text-decoration:underline;
    }
    
    .phc-finder {
      background:#e3f2fd;
      padding:20px;
      border-radius:12px;
      margin-top:16px;
      border-left:4px solid #2196f3;
    }
    .phc-finder h4 {
      margin-top:0;
      color:#1976d2;
    }
    .phc-finder select {
      width:100%;
      padding:12px;
      margin:8px 0;
      border:2px solid #2196f3;
      border-radius:8px;
      font-size:15px;
    }
    .phc-finder button {
      width:100%;
      padding:12px;
      background:#2196f3;
      color:white;
      border:none;
      border-radius:8px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      margin-top:8px;
    }
    .phc-finder button:hover {
      background:#1976d2;
    }
    
    .action-buttons {
      display:flex;
      gap:12px;
      margin-top:20px;
      flex-wrap:wrap;
    }
    .action-btn {
      flex:1;
      min-width:140px;
      padding:12px;
      background: linear-gradient(135deg, #5c6bc0 0%, #7986cb 100%);
      color:white;
      border:none;
      border-radius:8px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
    }
    .action-btn:hover {
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(92,107,192,0.4);
    }
    
    .hidden {display:none;}
    
    .start-btn {
      display:inline-block;
      padding:16px 48px;
      background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
      color:white;
      border:none;
      border-radius:12px;
      font-size:18px;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 4px 16px rgba(76,175,80,0.4);
      transition:all 0.3s;
    }
    .start-btn:hover {
      transform:translateY(-3px);
      box-shadow:0 6px 20px rgba(76,175,80,0.5);
    }
    
    .about-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      padding: 16px 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-top: 20px;
      transition: all 0.3s;
      border-left: 4px solid #607d8b;
    }
    .about-header:hover {
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      transform: translateY(-2px);
    }
    .about-developer {
      font-size: 15px;
      color: #455a64;
      margin: 0;
      line-height: 1.6;
    }
    .about-developer strong {
      color: #607d8b;
      font-weight: 600;
    }
    .club-name {
      color: #455a64;
      font-weight: 700;
      font-size: 16px;
    }
    .expand-icon {
      font-size: 24px;
      color: #607d8b;
      transition: transform 0.3s;
    }
    .expand-icon.expanded {
      transform: rotate(180deg);
    }
    .about-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease-out, padding 0.4s ease-out;
      background: white;
      border-radius: 0 0 12px 12px;
      margin-top: -12px;
      padding: 0 20px;
    }
    .about-content.expanded {
      max-height: 500px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .about-content p {
      margin: 12px 0;
      font-size: 14px;
      line-height: 1.6;
      color: #555;
    }
    
    footer {
      margin-top:40px;
      padding:24px 20px;
      text-align:center;
      color:white;
      background: linear-gradient(135deg, rgba(84,110,122,0.85) 0%, rgba(96,125,139,0.9) 100%);
      border-radius:12px;
    }
    footer p {margin:6px 0; font-size:13px;}
    
    .privacy-footer {
      background: #f5f5f5;
      padding: 12px 16px;
      margin-top: 16px;
      border-radius: 8px;
      font-size: 11px;
      color: #666;
      display: flex;
      align-items: center;
      gap: 8px;
      line-height: 1.4;
    }
    .privacy-footer span {
      font-size: 16px;
    }
    
    @media (max-width: 600px) {
      .container {padding:12px;}
      .card {padding:16px;}
      .nav-buttons {flex-direction:column;}
      .action-buttons {flex-direction:column;}
      .action-btn {min-width:100%;}
      .about-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
  </style>
</head>

<body>

<header role="banner">
  <h1 id="title">ЁЯй║ Aarogya Link</h1>
  <p id="subtitle">Smart Progressive Anemia Risk Screening</p>
  <p id="tagline">Empowering Women's Health | Ages 15тАУ49</p>

  <div class="lang-toggle" role="group" aria-label="Language selection">
    <button class="lang-btn active" onclick="setLang('en')" id="btn-en">English</button>
    <button class="lang-btn" onclick="setLang('hi')" id="btn-hi">рд╣рд┐рдВрджреА</button>
    <button class="lang-btn" onclick="setLang('mr')" id="btn-mr">рдорд░рд╛рдареА</button>
  </div>
</header>

<div class="container">

  <!-- Hero Banner -->
  <div class="card" id="heroCard" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; padding: 50px 20px; margin-top: 20px; border: none; position: relative; overflow: hidden;">
    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.1; background-image: radial-gradient(circle, white 1px, transparent 1px); background-size: 20px 20px;"></div>
    <div style="position: absolute; top: 20px; left: 20px; font-size: 60px; opacity: 0.2;">ЁЯМ╕</div>
    <div style="position: absolute; top: 40px; right: 30px; font-size: 50px; opacity: 0.2;">ЁЯТЭ</div>
    <div style="position: absolute; bottom: 30px; left: 40px; font-size: 45px; opacity: 0.2;">ЁЯй║</div>
    <div style="position: absolute; bottom: 20px; right: 20px; font-size: 55px; opacity: 0.2;">тЬи</div>
    
    <div style="max-width: 800px; margin: auto; position: relative; z-index: 1;">
      <div style="display: inline-block; background: rgba(255,255,255,0.25); backdrop-filter: blur(10px); border-radius: 50px; padding: 15px 30px; margin-bottom: 20px; border: 2px solid rgba(255,255,255,0.3);">
        <span style="font-size: 32px; display: inline-block; animation: pulse 2s infinite;">ЁЯТЧ</span>
      </div>
      
      <h2 id="heroTitle" style="font-size: clamp(28px, 6vw, 42px); margin: 0 0 16px 0; font-weight: 800; color: white; border: none; padding: 0; text-shadow: 0 2px 10px rgba(0,0,0,0.2); letter-spacing: -0.5px; line-height: 1.2;">
        ЁЯМ╕ Women's Health Screening Initiative
      </h2>
      
      <div style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px 30px; margin: 20px auto; max-width: 600px; border: 2px solid rgba(255,255,255,0.3); box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
        <p style="font-size: clamp(17px, 3.5vw, 22px); margin: 0; opacity: 1; line-height: 1.5; font-weight: 600;">
          <span id="heroSubtitle">Free anemia risk assessment for women aged 15-49</span>
        </p>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
          <p style="font-size: clamp(13px, 3vw, 16px); margin: 0; opacity: 0.95; line-height: 1.6;">
            <span id="heroTagline">Supporting community health through early detection and awareness</span>
          </p>
        </div>
      </div>
      
      <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 16px; padding: 20px; margin: 24px auto; max-width: 600px; border: 2px solid rgba(255,255,255,0.25); text-align: left;">
        <p id="welcomeText" style="font-size: clamp(14px, 3vw, 16px); margin: 0 0 12px 0; line-height: 1.7; opacity: 0.95;">
          This quick 10-question assessment will help identify your anemia risk level. It takes just 2-3 minutes and provides personalized recommendations and local health resources.
        </p>
        <p id="welcomeDisclaimer" style="font-size: clamp(12px, 2.5vw, 14px); margin: 0; opacity: 0.9; font-weight: 600; display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 18px;">тЪая╕П</span>
          <span>Remember: This is a screening tool, not a diagnosis. Always consult healthcare professionals for medical advice.</span>
        </p>
      </div>
      
      <button class="start-btn" onclick="startScreening()" id="startBtn" style="margin-top: 24px;">
        ЁЯЪА Start Screening
      </button>
      
      <div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-top: 25px;">
        <div style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 25px; padding: 10px 20px; border: 1px solid rgba(255,255,255,0.3); font-size: 14px; font-weight: 600;">
          <span id="feature1">тЪб 2 Minute Test</span>
        </div>
        <div style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 25px; padding: 10px 20px; border: 1px solid rgba(255,255,255,0.3); font-size: 14px; font-weight: 600;">
          <span id="feature2">ЁЯФТ 100% Private</span>
        </div>
        <div style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 25px; padding: 10px 20px; border: 1px solid rgba(255,255,255,0.3); font-size: 14px; font-weight: 600;">
          <span id="feature3">ЁЯМР 3 Languages</span>
        </div>
        <div style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 25px; padding: 10px 20px; border: 1px solid rgba(255,255,255,0.3); font-size: 14px; font-weight: 600;">
          <span id="feature4">ЁЯТп Free Forever</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Collapsible About -->
  <div class="about-header" id="aboutHeader" onclick="toggleAbout()">
    <p class="about-developer" id="aboutDeveloperShort">
      <strong>Developed by:</strong> <span class="club-name">The Rotaract Club of D.Y. Patil School of Biotechnology and Bioinformatics</span>
    </p>
    <span class="expand-icon" id="expandIcon">тЦ╝</span>
  </div>
  <div class="about-content" id="aboutContent">
    <p id="aboutDescription">We are an institution-based youth organization bringing together people ages 18 and older to exchange ideas, focused on making a positive impact through community service, professional development, and cultural initiatives.</p>
    <p id="aboutLocation">Located in Navi Mumbai (Satellite City, Zone 1, RID 3142), our club encourages students to initiate impactful projects in environment, education, and empowerment, while promoting teamwork, leadership, and international fellowship.</p>
    <p id="aboutMission"><strong>Mission:</strong> Bridging healthcare gaps through awareness, screening, and timely referrals for all communities.</p>
  </div>

  <!-- Screening Card -->
  <div class="card hidden" id="screeningCard">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill" style="width:0%"></div>
    </div>
    <div class="progress-text" id="progressText">Question 1 of 10</div>
    
    <div class="question-container" id="questionContainer">
      <div class="question-text" id="questionText"></div>
      <div id="visualHelper"></div>
      <div class="options-container" id="optionsContainer"></div>
    </div>
    
    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="previousQuestion()" id="prevBtn" disabled>тЖР Previous</button>
      <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn" disabled>Next тЖТ</button>
    </div>
  </div>

  <!-- Result Card -->
  <div class="result-card" id="resultCard">
    <h2 id="resultTitle"></h2>
    <p id="resultText"></p>
    
    <div class="next-steps">
      <h3 id="nextStepsTitle">ЁЯУЛ Recommended Next Steps</h3>
      <div id="nextStepsContent"></div>
    </div>
    
    <div class="next-steps">
      <h3 id="healthResourcesTitle">ЁЯПе Local Health Resources</h3>
      <ul id="healthResourcesList">
        <li>ЁЯУЮ <strong>National Health Helpline:</strong> 104</li>
        <li>ЁЯСй <strong>Women Helpline:</strong> 1091</li>
        <li>ЁЯЪС <strong>Emergency Ambulance:</strong> 108</li>
        <li>ЁЯФЧ <strong>Anemia Mukt Bharat:</strong> <a href="https://anemiamuktbharat.info/" target="_blank" rel="noopener noreferrer">Official Portal</a></li>
        <li>ЁЯУН <strong>Find Nearest PHC:</strong> <a href="#" onclick="findNearestPHC(); return false;" id="findPHCLink">Use Location Services</a></li>
      </ul>
      
      <div class="phc-finder" id="phcFinder">
        <h4 id="phcFinderTitle">ЁЯЧ║я╕П Find PHC by Location</h4>
        <select id="stateSelect" onchange="loadDistricts()">
          <option value="">Select Your State</option>
          <option value="maharashtra">Maharashtra</option>
          <option value="gujarat">Gujarat</option>
          <option value="karnataka">Karnataka</option>
          <option value="delhi">Delhi</option>
          <option value="up">Uttar Pradesh</option>
          <option value="mp">Madhya Pradesh</option>
        </select>
        <select id="districtSelect">
          <option value="">Select Your District</option>
        </select>
        <button onclick="showPHCContacts()" id="showPHCBtn">Find Nearest PHC</button>
        <div id="phcResults" style="margin-top:12px; display:none;"></div>
      </div>
    </div>
    
    <div class="action-buttons">
      <button class="action-btn" onclick="shareWhatsApp()">ЁЯУ▒ <span id="btnWhatsApp">Share on WhatsApp</span></button>
      <button class="action-btn" onclick="printResults()">ЁЯУД <span id="btnPrint">Print Results</span></button>
      <button class="action-btn" onclick="saveResults()">ЁЯТ╛ <span id="btnSave">Save to Phone</span></button>
      <button class="action-btn" style="background:linear-gradient(135deg, #78909c 0%, #90a4ae 100%);" onclick="resetScreening()">ЁЯФД <span id="btnReset">New Screening</span></button>
    </div>
    
    <!-- FIX 1: onclick passes 'this' instead of relying on implicit event -->
    <div class="next-steps" style="margin-top: 32px; background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%); border-left: 4px solid #3B82F6;">
      <h3 style="color: #1E40AF;">ЁЯУК <span id="progressTrackerTitle">Track Your Health Journey</span></h3>
      <div id="progressTrackerContent">
        <p id="progressTrackerText" style="font-size: 15px; line-height: 1.7;">Want to see your improvement over time? Save your unique Progress Code and come back in 2-4 weeks to retake the screening. We'll show you how much you've improved!</p>
        
        <div style="background: white; padding: 24px; border-radius: 12px; margin: 16px 0; border: 2px dashed #3B82F6;">
          <div style="text-align: center;">
            <div style="font-size: 13px; color: #64748b; margin-bottom: 8px;" id="progressCodeLabel">Your Progress Code</div>
            <div style="font-size: 32px; font-weight: 700; color: #1E40AF; letter-spacing: 3px; font-family: monospace;" id="progressCode">AH-XXXX</div>
            <div style="font-size: 12px; color: #64748b; margin-top: 8px;" id="progressCodeDate">Generated: <span id="progressCodeDateValue"></span></div>
          </div>
          <button onclick="copyProgressCode(this)" style="width: 100%; margin-top: 16px; padding: 12px; background: #3B82F6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 15px;">
            ЁЯУЛ <span id="btnCopyCode">Copy Progress Code</span>
          </button>
        </div>
        
        <div style="background: rgba(59, 130, 246, 0.1); padding: 16px; border-radius: 10px; margin-top: 16px;">
          <p style="margin: 0; font-size: 14px; color: #1E40AF;">
            <strong>ЁЯТб <span id="progressTip">How it works:</span></strong><br>
            <span id="progressTipText">Save this code safely. Return in 2-4 weeks, enter your code, retake screening, and see your progress chart! All data stays private on your device.</span>
          </p>
        </div>
      </div>
    </div>
    
    <!-- 21-Day Challenge -->
    <div class="next-steps" style="margin-top: 24px; background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%); border-left: 4px solid #10B981;" id="challengeSection">
      <h3 style="color: #065F46;">ЁЯОп <span id="challengeTitle">Start 21-Day Health Boost Challenge</span></h3>
      <div id="challengeContent">
        <p id="challengeText" style="font-size: 15px; line-height: 1.7;">Small daily habits can make a big difference! Track your progress with these simple actions:</p>
        
        <div style="background: white; padding: 20px; border-radius: 12px; margin: 16px 0;">
          <div style="margin-bottom: 16px;">
            <div style="font-weight: 700; color: #065F46; margin-bottom: 12px; font-size: 16px;" id="dailyGoalsTitle">Daily Goals (Check what you did today):</div>
            <div id="dailyGoals" style="display: flex; flex-direction: column; gap: 10px;">
              <label style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #F8FAFC; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                <input type="checkbox" onchange="updateChallenge()" style="width: 20px; height: 20px; cursor: pointer;">
                <span id="goal1">ЁЯем Ate iron-rich food (spinach, dal, eggs, jaggery)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #F8FAFC; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                <input type="checkbox" onchange="updateChallenge()" style="width: 20px; height: 20px; cursor: pointer;">
                <span id="goal2">ЁЯНЛ Added vitamin C to meals (lemon, amla, orange)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #F8FAFC; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                <input type="checkbox" onchange="updateChallenge()" style="width: 20px; height: 20px; cursor: pointer;">
                <span id="goal3">тШХ No tea/coffee for 1 hour after meals</span>
              </label>
              <label style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #F8FAFC; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                <input type="checkbox" onchange="updateChallenge()" style="width: 20px; height: 20px; cursor: pointer;">
                <span id="goal4">ЁЯЪ╢ 15 minutes walk or yoga</span>
              </label>
            </div>
          </div>
          
          <div style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; margin-top: 16px;">
            <div style="font-size: 48px; font-weight: 700;" id="streakDisplay">ЁЯФе 0</div>
            <div style="font-size: 14px; opacity: 0.9; margin-top: 4px;" id="streakLabel">Day Streak</div>
            <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;" id="streakMotivation">Start today to build your streak!</div>
          </div>
        </div>
        
        <div style="background: rgba(16, 185, 129, 0.1); padding: 16px; border-radius: 10px;">
          <p style="margin: 0; font-size: 14px; color: #065F46;">
            <strong>тЬи <span id="challengeBonus">Bonus Tip:</span></strong><br>
            <span id="challengeBonusText">Complete all 4 goals for 21 days straight and you will form lasting healthy habits. Your body will thank you!</span>
          </p>
        </div>
      </div>
    </div>
    
    <!-- Educational Articles -->
    <div class="next-steps" style="margin-top: 24px; background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-left: 4px solid #F59E0B;">
      <h3 style="color: #92400E;">ЁЯУЪ <span id="learnMoreTitle">Learn More About Anemia</span></h3>
      <div id="learnMoreContent">
        <p id="learnMoreText" style="font-size: 15px; line-height: 1.7;">Knowledge is power! Read these short articles to understand anemia better:</p>
        
        <div style="display: grid; gap: 12px; margin-top: 16px;">
          <div class="article-card" onclick="toggleArticle('article1')" style="background: white; padding: 16px; border-radius: 10px; cursor: pointer; border: 2px solid #FDE68A; transition: all 0.3s;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 700; color: #92400E; font-size: 15px;">ЁЯН│ 5 Iron-Rich Breakfast Ideas</div>
                <div style="font-size: 13px; color: #78716C; margin-top: 4px;" id="article1Subtitle">Quick, tasty, and nutritious</div>
              </div>
              <span id="article1Arrow" style="font-size: 20px; color: #F59E0B;">тЦ╝</span>
            </div>
            <div id="article1" class="article-content" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #FDE68A; font-size: 14px; line-height: 1.8; color: #44403C;"></div>
          </div>
          
          <div class="article-card" onclick="toggleArticle('article2')" style="background: white; padding: 16px; border-radius: 10px; cursor: pointer; border: 2px solid #FDE68A; transition: all 0.3s;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 700; color: #92400E; font-size: 15px;">тШХ Why Tea After Meals Reduces Iron</div>
                <div style="font-size: 13px; color: #78716C; margin-top: 4px;" id="article2Subtitle">The science explained simply</div>
              </div>
              <span id="article2Arrow" style="font-size: 20px; color: #F59E0B;">тЦ╝</span>
            </div>
            <div id="article2" class="article-content" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #FDE68A; font-size: 14px; line-height: 1.8; color: #44403C;"></div>
          </div>
          
          <div class="article-card" onclick="toggleArticle('article3')" style="background: white; padding: 16px; border-radius: 10px; cursor: pointer; border: 2px solid #FDE68A; transition: all 0.3s;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 700; color: #92400E; font-size: 15px;">тЪая╕П Warning Signs - When to Visit PHC</div>
                <div style="font-size: 13px; color: #78716C; margin-top: 4px;" id="article3Subtitle">Don't ignore these symptoms</div>
              </div>
              <span id="article3Arrow" style="font-size: 20px; color: #F59E0B;">тЦ╝</span>
            </div>
            <div id="article3" class="article-content" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #FDE68A; font-size: 14px; line-height: 1.8; color: #44403C;"></div>
          </div>
          
          <div class="article-card" onclick="toggleArticle('article4')" style="background: white; padding: 16px; border-radius: 10px; cursor: pointer; border: 2px solid #FDE68A; transition: all 0.3s;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 700; color: #92400E; font-size: 15px;">ЁЯй║ Understanding Hemoglobin Levels</div>
                <div style="font-size: 13px; color: #78716C; margin-top: 4px;" id="article4Subtitle">What the numbers mean</div>
              </div>
              <span id="article4Arrow" style="font-size: 20px; color: #F59E0B;">тЦ╝</span>
            </div>
            <div id="article4" class="article-content" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #FDE68A; font-size: 14px; line-height: 1.8; color: #44403C;"></div>
          </div>
          
          <div class="article-card" onclick="toggleArticle('article5')" style="background: white; padding: 16px; border-radius: 10px; cursor: pointer; border: 2px solid #FDE68A; transition: all 0.3s;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 700; color: #92400E; font-size: 15px;">ЁЯПа Simple Home Remedies for Energy</div>
                <div style="font-size: 13px; color: #78716C; margin-top: 4px;" id="article5Subtitle">Natural ways to feel better</div>
              </div>
              <span id="article5Arrow" style="font-size: 20px; color: #F59E0B;">тЦ╝</span>
            </div>
            <div id="article5" class="article-content" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #FDE68A; font-size: 14px; line-height: 1.8; color: #44403C;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- References -->
  <div class="card" id="referencesCard" style="display:none;">
    <h2 id="refTitle">Scientific References & Resources</h2>
    <div class="ref" style="font-size:13px; line-height:1.6; color:#555;">
      <p>[1] World Health Organization. Guideline on haemoglobin cut-offs to define anaemia. WHO; 2024. Available from: https://www.who.int/publications/i/item/9789240088542</p>
      <p>[2] World Health Organization. Anaemia тАУ Fact Sheet. WHO; 2024. Available from: https://www.who.int/news-room/fact-sheets/detail/anaemia</p>
      <p>[3] Ministry of Health & Family Welfare, Government of India. Anemia Mukt Bharat: Operational Guidelines. National Health Mission. Available from: https://nhm.gov.in/index1.php?lang=1&level=3&lid=797&sublinkid=1448</p>
      <p>[4] International Institute for Population Sciences (IIPS) and ICF. National Family Health Survey (NFHS-5), India Report 2019тАУ21. DHS Program; 2021.</p>
      <p>[5] Akpan IJ, et al. Heavy menstrual bleeding and iron deficiency anemia: clinical review. Int J Gynaecol Obstet. 2025.</p>
      <p>[6] Vyas N, et al. Accuracy of physical examination (pallor) for diagnosing anemia: systematic review. Cureus. 2022.</p>
      <p>[7] Disler PB, et al. The effect of tea on iron absorption. Gut. 1975;16:193тАУ200.</p>
    </div>
  </div>

  <footer role="contentinfo">
    <p><strong>Aarogya Link</strong> | Rotaract Club of D.Y. Patil SBB, Navi Mumbai</p>
    <p>Community Health Initiative | Zone 1, RID 3142</p>
    <p id="footerText">For awareness and referral support only | Not a substitute for medical diagnosis</p>
    <div class="privacy-footer">
      <span>ЁЯФТ</span>
      <span id="privacyFooter"><strong>Privacy:</strong> No personal data is stored on our servers. All screening information remains private on your device. We only collect anonymous usage statistics to improve the tool.</span>
    </div>
  </footer>

</div>

<script>
  // ==========================================
  // MULTILINGUAL CONTENT
  // ==========================================
  var translations = {
    en: {
      title:"ЁЯй║ Aarogya Link",subtitle:"Smart Progressive Anemia Risk Screening",tagline:"Empowering Women's Health | Ages 15тАУ49",
      aboutDeveloperShort:"<strong>Developed by:</strong> <span class='club-name'>The Rotaract Club of D.Y. Patil School of Biotechnology and Bioinformatics</span>",
      aboutDescription:"We are an institution-based youth organization bringing together people ages 18 and older to exchange ideas, focused on making a positive impact through community service, professional development, and cultural initiatives.",
      aboutLocation:"Located in Navi Mumbai (Satellite City, Zone 1, RID 3142), our club encourages students to initiate impactful projects in environment, education, and empowerment, while promoting teamwork, leadership, and international fellowship.",
      aboutMission:"<strong>Mission:</strong> Bridging healthcare gaps through awareness, screening, and timely referrals for all communities.",
      welcomeText:"This quick 10-question assessment will help identify your anemia risk level. It takes just 2-3 minutes and provides personalized recommendations and local health resources.",
      welcomeDisclaimer:"Remember: This is a screening tool, not a diagnosis. Always consult healthcare professionals for medical advice.",
      startBtn:"ЁЯЪА Start Screening",
      heroTitle:"ЁЯМ╕ Women's Health Screening Initiative",heroSubtitle:"Free anemia risk assessment for women aged 15-49",heroTagline:"Supporting community health through early detection and awareness",
      privacyFooter:"<strong>Privacy:</strong> No personal data is stored on our servers. All screening information remains private on your device. We only collect anonymous usage statistics to improve the tool.",
      feature1:"тЪб 2 Minute Test",feature2:"ЁЯФТ 100% Private",feature3:"ЁЯМР 3 Languages",feature4:"ЁЯТп Free Forever",
      nextStepsTitle:"ЁЯУЛ Recommended Next Steps",healthResourcesTitle:"ЁЯПе Local Health Resources",refTitle:"Scientific References & Resources",
      phcFinderTitle:"ЁЯЧ║я╕П Find PHC by Location",findPHCLink:"Use Location Services",showPHCBtn:"Find Nearest PHC",
      btnWhatsApp:"Share on WhatsApp",btnPrint:"Print Results",btnSave:"Save to Phone",btnReset:"New Screening",
      progressTrackerTitle:"Track Your Health Journey",btnCopyCode:"Copy Progress Code",
      challengeTitle:"Start 21-Day Health Boost Challenge",
      goal1:"ЁЯем Ate iron-rich food (spinach, dal, eggs, jaggery)",goal2:"ЁЯНЛ Added vitamin C to meals (lemon, amla, orange)",
      goal3:"тШХ No tea/coffee for 1 hour after meals",goal4:"ЁЯЪ╢ 15 minutes walk or yoga",
      streakLabel:"Day Streak",
      learnMoreTitle:"Learn More About Anemia",
      footerText:"For awareness and referral support only | Not a substitute for medical diagnosis"
    },
    hi: {
      title:"ЁЯй║ рдЖрд░реЛрдЧреНрдп рд▓рд┐рдВрдХ",subtitle:"рд╕реНрдорд╛рд░реНрдЯ рдкреНрд░рдЧрддрд┐рд╢реАрд▓ рдПрдиреАрдорд┐рдпрд╛ рдЬреЛрдЦрд┐рдо рдЬрд╛рдВрдЪ",tagline:"рдорд╣рд┐рд▓рд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдХреЛ рд╕рд╢рдХреНрдд рдмрдирд╛рдирд╛ | 15тАУ49 рд╡рд░реНрд╖",
      aboutDeveloperShort:"<strong>рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛:</strong> <span class='club-name'>рд░реЛрдЯрд░реИрдХреНрдЯ рдХреНрд▓рдм рдСрдлрд╝ рдбреА.рд╡рд╛рдп. рдкрд╛рдЯрд┐рд▓ рд╕реНрдХреВрд▓ рдСрдлрд╝ рдмрд╛рдпреЛрдЯреЗрдХреНрдиреЛрд▓реЙрдЬреА рдПрдВрдб рдмрд╛рдпреЛрдЗрдиреНрдлреЙрд░реНрдореЗрдЯрд┐рдХреНрд╕</span>",
      aboutDescription:"рд╣рдо рдПрдХ рд╕рдВрд╕реНрдерд╛рдЧрдд рдпреБрд╡рд╛ рд╕рдВрдЧрдарди рд╣реИрдВ рдЬреЛ 18 рд╡рд░реНрд╖ рдФрд░ рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рдЙрдореНрд░ рдХреЗ рд▓реЛрдЧреЛрдВ рдХреЛ рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЗ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рде рд▓рд╛рддрд╛ рд╣реИред",
      aboutLocation:"рдирд╡реА рдореБрдВрдмрдИ (рд╕реИрдЯреЗрд▓рд╛рдЗрдЯ рд╕рд┐рдЯреА, рдЬрд╝реЛрди 1, рдЖрд░рдЖрдИрдбреА 3142) рдореЗрдВ рд╕реНрдерд┐рддред",
      aboutMission:"<strong>рдорд┐рд╢рди:</strong> рд╕рднреА рд╕рдореБрджрд╛рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд╛рдЧрд░реВрдХрддрд╛, рдЬрд╛рдВрдЪ рдФрд░ рд╕рдордп рдкрд░ рд░реЗрдлрд░рд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╕реЗрд╡рд╛ рдЕрдВрддрд░рд╛рд▓ рдХреЛ рдкрд╛рдЯрдирд╛ред",
      welcomeText:"рдпрд╣ рддреНрд╡рд░рд┐рдд 10-рдкреНрд░рд╢реНрди рдореВрд▓реНрдпрд╛рдВрдХрди рдЖрдкрдХреЗ рдПрдиреАрдорд┐рдпрд╛ рдЬреЛрдЦрд┐рдо рд╕реНрддрд░ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред",
      welcomeDisclaimer:"рдпрд╛рдж рд░рдЦреЗрдВ: рдпрд╣ рдПрдХ рдЬрд╛рдВрдЪ рдЙрдкрдХрд░рдг рд╣реИ, рдирд┐рджрд╛рди рдирд╣реАрдВред",
      startBtn:"ЁЯЪА рдЬрд╛рдВрдЪ рд╢реБрд░реВ рдХрд░реЗрдВ",
      heroTitle:"ЁЯМ╕ рдорд╣рд┐рд▓рд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдЬрд╛рдВрдЪ рдкрд╣рд▓",heroSubtitle:"15-49 рд╡рд░реНрд╖ рдХреА рдорд╣рд┐рд▓рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдореБрдлреНрдд рдПрдиреАрдорд┐рдпрд╛ рдЬреЛрдЦрд┐рдо рдореВрд▓реНрдпрд╛рдВрдХрди",heroTagline:"рд╢реАрдШреНрд░ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рдЬрд╛рдЧрд░реВрдХрддрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд╛рдореБрджрд╛рдпрд┐рдХ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдХрд╛ рд╕рдорд░реНрдерди",
      privacyFooter:"<strong>рдЧреЛрдкрдиреАрдпрддрд╛:</strong> рд╣рдорд╛рд░реЗ рд╕рд░реНрд╡рд░ рдкрд░ рдХреЛрдИ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред",
      feature1:"тЪб 2 рдорд┐рдирдЯ рдХреА рдЬрд╛рдВрдЪ",feature2:"ЁЯФТ 100% рдирд┐рдЬреА",feature3:"ЁЯМР 3 рднрд╛рд╖рд╛рдПрдВ",feature4:"ЁЯТп рд╣рдореЗрд╢рд╛ рдореБрдлреНрдд",
      nextStepsTitle:"ЁЯУЛ рдЕрдиреБрд╢рдВрд╕рд┐рдд рдЕрдЧрд▓реЗ рдХрджрдо",healthResourcesTitle:"ЁЯПе рд╕реНрдерд╛рдиреАрдп рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╕рдВрд╕рд╛рдзрди",refTitle:"рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рд╕рдВрджрд░реНрдн рдФрд░ рд╕рдВрд╕рд╛рдзрди",
      phcFinderTitle:"ЁЯЧ║я╕П рд╕реНрдерд╛рди рдХреЗ рдЕрдиреБрд╕рд╛рд░ PHC рдЦреЛрдЬреЗрдВ",findPHCLink:"рд╕реНрдерд╛рди рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ",showPHCBtn:"рдирд┐рдХрдЯрддрдо PHC рдЦреЛрдЬреЗрдВ",
      btnWhatsApp:"WhatsApp рдкрд░ рд╢реЗрдпрд░ рдХрд░реЗрдВ",btnPrint:"рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ",btnSave:"рдлреЛрди рдореЗрдВ рд╕реЗрд╡ рдХрд░реЗрдВ",btnReset:"рдирдИ рдЬрд╛рдВрдЪ",
      progressTrackerTitle:"рдЖрдкрдХреА рд╕реНрд╡рд╛рд╕реНрдереНрдп рдпрд╛рддреНрд░рд╛ рдЯреНрд░реИрдХ рдХрд░реЗрдВ",btnCopyCode:"рдкреНрд░рдЧрддрд┐ рдХреЛрдб рдХреЙрдкреА рдХрд░реЗрдВ",
      challengeTitle:"21 рджрд┐рди рд╕реНрд╡рд╛рд╕реНрдереНрдп рдмреВрд╕реНрдЯ рдЪреБрдиреМрддреА рд╢реБрд░реВ рдХрд░реЗрдВ",
      goal1:"ЁЯем рдЖрдпрд░рди рдпреБрдХреНрдд рдЦрд╛рдирд╛ рдЦрд╛рдпрд╛",goal2:"ЁЯНЛ рднреЛрдЬрди рдореЗрдВ рд╡рд┐рдЯрд╛рдорд┐рди рд╕реА рд▓рд┐рдпрд╛",
      goal3:"тШХ рднреЛрдЬрди рдХреЗ рдмрд╛рдж 1 рдШрдВрдЯреЗ рддрдХ рдЪрд╛рдп/рдХреЙрдлреА рдирд╣реАрдВ",goal4:"ЁЯЪ╢ 15 рдорд┐рдирдЯ рдЪрд▓рдирд╛ рдпрд╛ рдпреЛрдЧ",
      streakLabel:"рджрд┐рди рдХреА рд▓рдп",
      learnMoreTitle:"рдПрдиреАрдорд┐рдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЬрд╛рдиреЗрдВ",
      footerText:"рдХреЗрд╡рд▓ рдЬрд╛рдЧрд░реВрдХрддрд╛ рдФрд░ рд░реЗрдлрд░рд▓ рд╕рд╣рд╛рдпрддрд╛ рдХреЗ рд▓рд┐рдП | рдЪрд┐рдХрд┐рддреНрд╕рд╛ рдирд┐рджрд╛рди рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ"
    },
    mr: {
      title:"ЁЯй║ рдЖрд░реЛрдЧреНрдп рд▓рд┐рдВрдХ",subtitle:"рд╕реНрдорд╛рд░реНрдЯ рдкреНрд░рдЧрддреАрд╢реАрд▓ рдЕреЕрдирд┐рдорд┐рдпрд╛ рдЬреЛрдЦреАрдо рддрдкрд╛рд╕рдгреА",tagline:"рдорд╣рд┐рд▓рд╛ рдЖрд░реЛрдЧреНрдп рд╕рд╢рдХреНрддреАрдХрд░рдг | рд╡рдп 15тАУ49",
      aboutDeveloperShort:"<strong>рд╡рд┐рдХрд╕рд┐рдд рдХреЗрд▓реЗ:</strong> <span class='club-name'>рд░реЛрдЯрд╛рд░реЕрдХреНрдЯ рдХреНрд▓рдм рдСрдл рдбреА.рд╡рд╛рдп. рдкрд╛рдЯреАрд▓ рд╕реНрдХреВрд▓ рдСрдл рдмрд╛рдпреЛрдЯреЗрдХреНрдиреЙрд▓реЙрдЬреА рдЕрдБрдб рдмрд╛рдпреЛрдЗрдиреНрдлреЙрд░реНрдореЗрдЯрд┐рдХреНрд╕</span>",
      aboutDescription:"рдЖрдореНрд╣реА рдПрдХ рд╕рдВрд╕реНрдерд╛-рдЖрдзрд╛рд░рд┐рдд рдпреБрд╡рд╛ рд╕рдВрдШрдЯрдирд╛ рдЖрд╣реЛрдд.",
      aboutLocation:"рдирд╡реА рдореБрдВрдмрдИ (рд╕реЕрдЯреЗрд▓рд╛рдЗрдЯ рд╕рд┐рдЯреА, рдЭреЛрди 1, рдЖрд░рдЖрдпрдбреА 3142) рдордзреНрдпреЗ рд╕реНрдерд┐рдд.",
      aboutMission:"<strong>рдзреНрдпреЗрдп:</strong> рд╕рд░реНрд╡ рд╕рдореБрджрд╛рдпрд╛рдВрд╕рд╛рдареА рдЬрд╛рдЧрд░реВрдХрддрд╛, рддрдкрд╛рд╕рдгреА рдЖрдгрд┐ рд╡реЗрд│реЗрд╡рд░ рд░реЗрдлрд░рд▓рджреНрд╡рд╛рд░реЗ рдЖрд░реЛрдЧреНрдп рд╕реЗрд╡рд╛ рдЕрдВрддрд░ рднрд░рдгреЗ.",
      welcomeText:"рд╣реЗ рджреНрд░реБрдд 10-рдкреНрд░рд╢реНрди рдореВрд▓реНрдпрд╛рдВрдХрди рддреБрдордЪреНрдпрд╛ рдЕреЕрдирд┐рдорд┐рдпрд╛ рдЬреЛрдЦреАрдо рдкрд╛рддрд│реАрдЪреА рдУрд│рдЦ рдХрд░рдгреНрдпрд╛рдд рдорджрдд рдХрд░реЗрд▓.",
      welcomeDisclaimer:"рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛: рд╣реЗ рддрдкрд╛рд╕рдгреА рд╕рд╛рдзрди рдЖрд╣реЗ, рдирд┐рджрд╛рди рдирд╛рд╣реА.",
      startBtn:"ЁЯЪА рддрдкрд╛рд╕рдгреА рд╕реБрд░реВ рдХрд░рд╛",
      heroTitle:"ЁЯМ╕ рдорд╣рд┐рд▓рд╛ рдЖрд░реЛрдЧреНрдп рддрдкрд╛рд╕рдгреА рдЙрдкрдХреНрд░рдо",heroSubtitle:"15-49 рд╡рдпреЛрдЧрдЯрд╛рддреАрд▓ рдорд╣рд┐рд▓рд╛рдВрд╕рд╛рдареА рдореЛрдлрдд рдЕреЕрдирд┐рдорд┐рдпрд╛ рдЬреЛрдЦреАрдо рдореВрд▓реНрдпрд╛рдВрдХрди",heroTagline:"рд▓рд╡рдХрд░ рд╢реЛрдз рдЖрдгрд┐ рдЬрд╛рдЧрд░реВрдХрддреЗрджреНрд╡рд╛рд░реЗ рд╕рд╛рдореБрджрд╛рдпрд┐рдХ рдЖрд░реЛрдЧреНрдпрд╛рд▓рд╛ рд╕рдорд░реНрдерди",
      privacyFooter:"<strong>рдЧреЛрдкрдиреАрдпрддрд╛:</strong> рдЖрдордЪреНрдпрд╛ рд╕рд░реНрд╡реНрд╣рд░рд╡рд░ рдХреЛрдгрддрд╛рд╣реА рд╡реИрдпрдХреНрддрд┐рдХ рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХреЗрд▓рд╛ рдЬрд╛рдд рдирд╛рд╣реА.",
      feature1:"тЪб 2 рдорд┐рдирд┐рдЯ рдЪрд╛рдЪрдгреА",feature2:"ЁЯФТ 100% рдЦрд╛рдЬрдЧреА",feature3:"ЁЯМР 3 рднрд╛рд╖рд╛",feature4:"ЁЯТп рдиреЗрд╣рдореА рдореЛрдлрдд",
      nextStepsTitle:"ЁЯУЛ рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реЗрд▓реА рдкреБрдвреАрд▓ рдкрд╛рдпрд▒реНрдпрд╛",healthResourcesTitle:"ЁЯПе рд╕реНрдерд╛рдирд┐рдХ рдЖрд░реЛрдЧреНрдп рд╕рдВрд╕рд╛рдзрдиреЗ",refTitle:"рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рд╕рдВрджрд░реНрдн рдЖрдгрд┐ рд╕рдВрд╕рд╛рдзрдиреЗ",
      phcFinderTitle:"ЁЯЧ║я╕П рд╕реНрдерд╛рдирд╛рдиреБрд╕рд╛рд░ PHC рд╢реЛрдзрд╛",findPHCLink:"рд╕реНрдерд╛рди рд╕реЗрд╡рд╛ рд╡рд╛рдкрд░рд╛",showPHCBtn:"рдЬрд╡рд│рдЪреЗ PHC рд╢реЛрдзрд╛",
      btnWhatsApp:"WhatsApp рд╡рд░ рд╢реЗрдЕрд░ рдХрд░рд╛",btnPrint:"рдкрд░рд┐рдгрд╛рдо рдореБрджреНрд░рд┐рдд рдХрд░рд╛",btnSave:"рдлреЛрдирдордзреНрдпреЗ рд╕реЗрд╡реНрд╣ рдХрд░рд╛",btnReset:"рдирд╡реАрди рддрдкрд╛рд╕рдгреА",
      progressTrackerTitle:"рддреБрдордЪреА рдЖрд░реЛрдЧреНрдп рдпрд╛рддреНрд░рд╛ рдЯреНрд░реЕрдХ рдХрд░рд╛",btnCopyCode:"рдкреНрд░рдЧрддреА рдХреЛрдб рдХреЙрдкреА рдХрд░рд╛",
      challengeTitle:"21-рджрд┐рд╡рд╕рд╛рдВрдЪреЗ рдЖрд░реЛрдЧреНрдп рдмреВрд╕реНрдЯ рдЖрд╡реНрд╣рд╛рди рд╕реБрд░реВ рдХрд░рд╛",
      goal1:"ЁЯем рдЖрдпрд░реНрди-рд╕рдореГрджреНрдз рдЕрдиреНрди рдЦрд╛рд▓реЗ",goal2:"ЁЯНЛ рдЬреЗрд╡рдгрд╛рдд рд╡реНрд╣рд┐рдЯреЕрдорд┐рди рд╕реА рдШреЗрддрд▓реЗ",
      goal3:"тШХ рдЬреЗрд╡рдгрд╛рдирдВрддрд░ 1 рддрд╛рд╕ рдЪрд╣рд╛/рдХреЙрдлреА рдирд╛рд╣реА",goal4:"ЁЯЪ╢ 15 рдорд┐рдирд┐рдЯрд╛рдВрдЪрд╛ рдЪрд╛рд▓ рдХрд┐рдВрд╡рд╛ рдпреЛрдЧ",
      streakLabel:"рджрд┐рд╡рд╕рд╛рдВрдЪреА рд▓рдп",
      learnMoreTitle:"рдЕреЕрдирд┐рдорд┐рдпрд╛рдмрджреНрджрд▓ рдЕрдзрд┐рдХ рдЬрд╛рдгрд╛",
      footerText:"рдХреЗрд╡рд│ рдЬрд╛рдЧрд░реВрдХрддрд╛ рдЖрдгрд┐ рд░реЗрдлрд░рд▓ рд╕рдорд░реНрдердирд╛рд╕рд╛рдареА | рд╡реИрджреНрдпрдХреАрдп рдирд┐рджрд╛рдирд╛рдЪрд╛ рдкрд░реНрдпрд╛рдп рдирд╛рд╣реА"
    }
  };

  // ==========================================
  // QUESTIONS
  // ==========================================
  var questions = [
    {id:'age',text:{en:"ЁЯУЕ What is your age?",hi:"ЁЯУЕ рдЖрдкрдХреА рдЙрдореНрд░ рдХреНрдпрд╛ рд╣реИ?",mr:"ЁЯУЕ рддреБрдордЪреЗ рд╡рдп рдХрд╛рдп рдЖрд╣реЗ?"},type:'number',placeholder:{en:"Enter age between 15-49",hi:"15-49 рдХреЗ рдмреАрдЪ рдЙрдореНрд░ рджрд░реНрдЬ рдХрд░реЗрдВ",mr:"15-49 рджрд░рдореНрдпрд╛рди рд╡рдп рдкреНрд░рд╡рд┐рд╖реНрдЯ рдХрд░рд╛"},min:15,max:49,score:0},
    {id:'pregnant',text:{en:"ЁЯд░ Are you currently pregnant?",hi:"ЁЯд░ рдХреНрдпрд╛ рдЖрдк рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЧрд░реНрднрд╡рддреА рд╣реИрдВ?",mr:"ЁЯд░ рддреБрдореНрд╣реА рд╕рдзреНрдпрд╛ рдЧрд░реНрднрд╡рддреА рдЖрд╣рд╛рдд рдХрд╛?"},options:[{text:{en:"тЭМ No",hi:"тЭМ рдирд╣реАрдВ",mr:"тЭМ рдирд╛рд╣реА"},score:0},{text:{en:"тЬЕ Yes",hi:"тЬЕ рд╣рд╛рдВ",mr:"тЬЕ рд╣реЛрдп"},score:3}]},
    {id:'postpartum',text:{en:"ЁЯС╢ Did you deliver a baby in the last 6 months?",hi:"ЁЯС╢ рдХреНрдпрд╛ рдЖрдкрдиреЗ рдкрд┐рдЫрд▓реЗ 6 рдорд╣реАрдиреЛрдВ рдореЗрдВ рдмрдЪреНрдЪреЗ рдХреЛ рдЬрдиреНрдо рджрд┐рдпрд╛ рд╣реИ?",mr:"ЁЯС╢ рддреБрдореНрд╣реА рдЧреЗрд▓реНрдпрд╛ 6 рдорд╣рд┐рдиреНрдпрд╛рдд рдмрд╛рд│рд╛рд▓рд╛ рдЬрдиреНрдо рджрд┐рд▓рд╛ рдЖрд╣реЗ рдХрд╛?"},options:[{text:{en:"тЭМ No",hi:"тЭМ рдирд╣реАрдВ",mr:"тЭМ рдирд╛рд╣реА"},score:0},{text:{en:"тЬЕ Yes",hi:"тЬЕ рд╣рд╛рдВ",mr:"тЬЕ рд╣реЛрдп"},score:3}]},
    {id:'fatigue',text:{en:"ЁЯШ┤ Do you experience persistent tiredness or weakness?",hi:"ЁЯШ┤ рдХреНрдпрд╛ рдЖрдк рд▓рдЧрд╛рддрд╛рд░ рдердХрд╛рди рдпрд╛ рдХрдордЬреЛрд░реА рдорд╣рд╕реВрд╕ рдХрд░рддреА рд╣реИрдВ?",mr:"ЁЯШ┤ рддреБрдореНрд╣рд╛рд▓рд╛ рд╕рддрдд рдердХрд╡рд╛ рдХрд┐рдВрд╡рд╛ рдЕрд╢рдХреНрддрдкрдгрд╛ рдЬрд╛рдгрд╡рддреЛ рдХрд╛?"},helper:{en:"Feeling constantly tired, low energy, difficulty doing daily work",hi:"рд▓рдЧрд╛рддрд╛рд░ рдердХрд╛рди рдорд╣рд╕реВрд╕ рдХрд░рдирд╛, рдХрдо рдКрд░реНрдЬрд╛",mr:"рд╕рддрдд рдердХрд╡рд╛ рдЬрд╛рдгрд╡рдгреЗ, рдХрдореА рдКрд░реНрдЬрд╛"},options:[{text:{en:"тЭМ No",hi:"тЭМ рдирд╣реАрдВ",mr:"тЭМ рдирд╛рд╣реА"},score:0},{text:{en:"тЬЕ Yes",hi:"тЬЕ рд╣рд╛рдВ",mr:"тЬЕ рд╣реЛрдп"},score:2}]},
    {id:'dizziness',text:{en:"ЁЯШ╡ Do you feel dizzy when standing up or walking?",hi:"ЁЯШ╡ рдХреНрдпрд╛ рдЦрдбрд╝реЗ рд╣реЛрдиреЗ рдпрд╛ рдЪрд▓рдиреЗ рдкрд░ рдЖрдкрдХреЛ рдЪрдХреНрдХрд░ рдЖрддрд╛ рд╣реИ?",mr:"ЁЯШ╡ рдЙрднреЗ рд░рд╛рд╣рддрд╛рдирд╛ рдХрд┐рдВрд╡рд╛ рдЪрд╛рд▓рддрд╛рдирд╛ рддреБрдореНрд╣рд╛рд▓рд╛ рдЪрдХреНрдХрд░ рдпреЗрддреЗ рдХрд╛?"},helper:{en:"Feeling lightheaded, unsteady, room spinning",hi:"рд╕рд┐рд░ рд╣рд▓реНрдХрд╛ рдорд╣рд╕реВрд╕ рд╣реЛрдирд╛, рдЕрд╕реНрдерд┐рд░",mr:"рдбреЛрдХреЗ рд╣рд▓рдХреЗ рд╡рд╛рдЯрдгреЗ, рдЕрд╕реНрдерд┐рд░ рд╡рд╛рдЯрдгреЗ"},options:[{text:{en:"тЭМ No",hi:"тЭМ рдирд╣реАрдВ",mr:"тЭМ рдирд╛рд╣реА"},score:0},{text:{en:"тЬЕ Yes",hi:"тЬЕ рд╣рд╛рдВ",mr:"тЬЕ рд╣реЛрдп"},score:2}]},
    {id:'breathless',text:{en:"ЁЯТи Do you experience breathlessness during normal daily activities?",hi:"ЁЯТи рдХреНрдпрд╛ рдЖрдк рд╕рд╛рдорд╛рдиреНрдп рджреИрдирд┐рдХ рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рджреМрд░рд╛рди рд╕рд╛рдВрд╕ рдлреВрд▓рдиреЗ рдХрд╛ рдЕрдиреБрднрд╡ рдХрд░рддреА рд╣реИрдВ?",mr:"ЁЯТи рддреБрдореНрд╣рд╛рд▓рд╛ рд╕рд╛рдорд╛рдиреНрдп рджреИрдирдВрджрд┐рди рдХрд╛рдорд╛рдВрджрд░рдореНрдпрд╛рди рд╢реНрд╡рд╛рд╕ рд▓рд╛рдЧрддреЛ рдХрд╛?"},helper:{en:"Difficulty breathing during walking, cooking, or climbing stairs",hi:"рдЪрд▓рдиреЗ, рдЦрд╛рдирд╛ рдмрдирд╛рдиреЗ рдпрд╛ рд╕реАрдврд╝рд┐рдпрд╛рдВ рдЪрдврд╝рдиреЗ рдореЗрдВ рдХрдард┐рдирд╛рдИ",mr:"рдЪрд╛рд▓рддрд╛рдирд╛, рд╕реНрд╡рдпрдВрдкрд╛рдХ рдХрд░рддрд╛рдирд╛ рд╢реНрд╡рд╛рд╕ рдШреЗрдгреНрдпрд╛рдд рдЕрдбрдЪрдг"},options:[{text:{en:"тЭМ No",hi:"тЭМ рдирд╣реАрдВ",mr:"тЭМ рдирд╛рд╣реА"},score:0},{text:{en:"тЬЕ Yes",hi:"тЬЕ рд╣рд╛рдВ",mr:"тЬЕ рд╣реЛрдп"},score:2}]},
    {id:'headache',text:{en:"ЁЯдХ Do you have frequent headaches or difficulty concentrating?",hi:"ЁЯдХ рдХреНрдпрд╛ рдЖрдкрдХреЛ рдмрд╛рд░-рдмрд╛рд░ рд╕рд┐рд░рджрд░реНрдж рдпрд╛ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдХрдард┐рдирд╛рдИ рд╣реЛрддреА рд╣реИ?",mr:"ЁЯдХ рддреБрдореНрд╣рд╛рд▓рд╛ рд╡рд╛рд░рдВрд╡рд╛рд░ рдбреЛрдХреЗрджреБрдЦреА рдХрд┐рдВрд╡рд╛ рд▓рдХреНрд╖ рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдгреНрдпрд╛рдд рдЕрдбрдЪрдг рдпреЗрддреЗ рдХрд╛?"},options:[{text:{en:"тЭМ No",hi:"тЭМ рдирд╣реАрдВ",mr:"тЭМ рдирд╛рд╣реА"},score:0},{text:{en:"тЬЕ Yes",hi:"тЬЕ рд╣рд╛рдВ",mr:"тЬЕ рд╣реЛрдп"},score:1}]},
    {id:'bleeding',text:{en:"ЁЯй╕ Do you experience heavy menstrual bleeding?",hi:"ЁЯй╕ рдХреНрдпрд╛ рдЖрдкрдХреЛ рдЕрдзрд┐рдХ рдорд╛рд╕рд┐рдХ рдзрд░реНрдо рд░рдХреНрддрд╕реНрд░рд╛рд╡ рд╣реЛрддрд╛ рд╣реИ?",mr:"ЁЯй╕ рддреБрдореНрд╣рд╛рд▓рд╛ рдЬрд╛рд╕реНрдд рдорд╛рд╕рд┐рдХ рдкрд╛рд│реА рд░рдХреНрддрд╕реНрд░рд╛рд╡ рд╣реЛрддреЛ рдХрд╛?"},helper:{en:"Soaking pad every 1-2 hours during periods",hi:"рдорд╛рд╕рд┐рдХ рдзрд░реНрдо рдХреЗ рджреМрд░рд╛рди рд╣рд░ 1-2 рдШрдВрдЯреЗ рдореЗрдВ рдкреИрдб рднрд┐рдЧреЛрдирд╛",mr:"рдорд╛рд╕рд┐рдХ рдкрд╛рд│реАрдЪреНрдпрд╛ рд╡реЗрд│реА рджрд░ 1-2 рддрд╛рд╕рд╛рдВрдиреА рдкреЕрдб рднрд┐рдЬрдгреЗ"},options:[{text:{en:"тЭМ No",hi:"тЭМ рдирд╣реАрдВ",mr:"тЭМ рдирд╛рд╣реА"},score:0},{text:{en:"тЬЕ Yes",hi:"тЬЕ рд╣рд╛рдВ",mr:"тЬЕ рд╣реЛрдп"},score:4},{text:{en:"ЁЯФТ Prefer not to say",hi:"ЁЯФТ рдирд╣реАрдВ рдмрддрд╛рдирд╛ рдЪрд╛рд╣рддреЗ",mr:"ЁЯФТ рд╕рд╛рдВрдЧреВ рдЗрдЪреНрдЫрд┐рдд рдирд╛рд╣реА"},score:0}]},
    {id:'diet',text:{en:"ЁЯем Do you eat iron-rich foods less than 3 times per week?",hi:"ЁЯем рдХреНрдпрд╛ рдЖрдк рд╕рдкреНрддрд╛рд╣ рдореЗрдВ 3 рдмрд╛рд░ рд╕реЗ рдХрдо рдЖрдпрд░рди рдпреБрдХреНрдд рдЦрд╛рджреНрдп рдкрджрд╛рд░реНрде рдЦрд╛рддреА рд╣реИрдВ?",mr:"ЁЯем рддреБрдореНрд╣реА рдЖрдард╡рдбреНрдпрд╛рддреВрди 3 рд╡реЗрд│реЗрдкреЗрдХреНрд╖рд╛ рдХрдореА рдЖрдпрд░реНрди-рд╕рдореГрджреНрдз рдкрджрд╛рд░реНрде рдЦрд╛рддрд╛рдд рдХрд╛?"},showFoodGallery:true,options:[{text:{en:"тЬЕ No (I eat regularly)",hi:"тЬЕ рдирд╣реАрдВ (рдирд┐рдпрдорд┐рдд рдЦрд╛рддреА рд╣реВрдВ)",mr:"тЬЕ рдирд╛рд╣реА (рдирд┐рдпрдорд┐рддрдкрдгреЗ рдЦрд╛рддреЗ)"},score:0},{text:{en:"тЭМ Yes (Less than 3├Ч/week)",hi:"тЭМ рд╣рд╛рдВ (рд╕рдкреНрддрд╛рд╣ рдореЗрдВ 3 рдмрд╛рд░ рд╕реЗ рдХрдо)",mr:"тЭМ рд╣реЛрдп (3 рд╡реЗрд│реЗрдкреЗрдХреНрд╖рд╛ рдХрдореА)"},score:2}]},
    {id:'tea',text:{en:"тШХ Do you drink tea or coffee immediately after meals?",hi:"тШХ рдХреНрдпрд╛ рдЖрдк рднреЛрдЬрди рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж рдЪрд╛рдп рдпрд╛ рдХреЙрдлреА рдкреАрддреА рд╣реИрдВ?",mr:"тШХ рддреБрдореНрд╣реА рдЬреЗрд╡рдгрд╛рдирдВрддрд░ рд▓рдЧреЗрдЪ рдЪрд╣рд╛ рдХрд┐рдВрд╡рд╛ рдХреЙрдлреА рдкрд┐рддрд╛ рдХрд╛?"},helper:{en:"Within 30 minutes of eating",hi:"рдЦрд╛рдиреЗ рдХреЗ 30 рдорд┐рдирдЯ рдХреЗ рднреАрддрд░",mr:"рдЬреЗрд╡рдгрд╛рдЪреНрдпрд╛ 30 рдорд┐рдирд┐рдЯрд╛рдВрдЪреНрдпрд╛ рдЖрдд"},options:[{text:{en:"тЭМ No",hi:"тЭМ рдирд╣реАрдВ",mr:"тЭМ рдирд╛рд╣реА"},score:0},{text:{en:"тЬЕ Yes",hi:"тЬЕ рд╣рд╛рдВ",mr:"тЬЕ рд╣реЛрдп"},score:1}]}
  ];

  // ==========================================
  // SAFE LOCALSTORAGE
  // ==========================================
  function safeLocalStorage(operation, key, value) {
    try {
      if (operation === 'get') return localStorage.getItem(key);
      if (operation === 'set') { localStorage.setItem(key, value); return true; }
      if (operation === 'remove') { localStorage.removeItem(key); return true; }
    } catch (e) {
      console.error('localStorage error:', e);
      gtag('event', 'exception', { 'description': 'localStorage_failed_' + operation, 'fatal': false });
      return null;
    }
  }

  // ==========================================
  // KEYBOARD NAV
  // ==========================================
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      var nextBtn = document.getElementById('nextBtn');
      if (nextBtn && !nextBtn.disabled && !nextBtn.classList.contains('hidden')) nextQuestion();
    }
    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
      var options = document.querySelectorAll('.option-btn');
      if (options.length === 0) return;
      var selected = document.querySelector('.option-btn.selected');
      var index = selected ? Array.prototype.indexOf.call(options, selected) : -1;
      index = e.key === 'ArrowDown' ? (index + 1) % options.length : (index <= 0 ? options.length - 1 : index - 1);
      options[index].click();
      options[index].focus();
      e.preventDefault();
    }
  });

  // ==========================================
  // GLOBAL STATE
  // ==========================================
  var currentLang = 'en';
  var currentQuestion = 0;
  var answers = {};
  var totalScore = 0;

  // ==========================================
  // HELPER: Get today as YYYY-M-D (cross-browser safe)
  // ==========================================
  function getTodayStr() {
    var d = new Date();
    return d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate();
  }

  // ==========================================
  // TOGGLE ABOUT
  // ==========================================
  function toggleAbout() {
    var content = document.getElementById('aboutContent');
    var icon = document.getElementById('expandIcon');
    content.classList.toggle('expanded');
    icon.classList.toggle('expanded');
  }

  // ==========================================
  // LANGUAGE
  // ==========================================
  function setLang(lang) {
    currentLang = lang;
    safeLocalStorage('set', 'preferredLanguage', lang);
    gtag('event', 'language_change', { 'event_category': 'engagement', 'language': lang });
    
    document.querySelectorAll(".lang-btn").forEach(function(btn) { btn.classList.remove("active"); });
    document.getElementById("btn-" + lang).classList.add("active");
    
    var t = translations[lang];
    document.getElementById("title").textContent = t.title;
    document.getElementById("subtitle").textContent = t.subtitle;
    document.getElementById("tagline").textContent = t.tagline;
    document.getElementById("aboutDeveloperShort").innerHTML = t.aboutDeveloperShort;
    document.getElementById("aboutDescription").textContent = t.aboutDescription;
    document.getElementById("aboutLocation").textContent = t.aboutLocation;
    document.getElementById("aboutMission").innerHTML = t.aboutMission;
    document.getElementById("welcomeText").textContent = t.welcomeText;
    document.getElementById("welcomeDisclaimer").innerHTML = '<span style="font-size:18px;">тЪая╕П</span><span>' + t.welcomeDisclaimer + '</span>';
    document.getElementById("startBtn").textContent = t.startBtn;
    document.getElementById("heroTitle").textContent = t.heroTitle;
    document.getElementById("heroSubtitle").textContent = t.heroSubtitle;
    document.getElementById("heroTagline").textContent = t.heroTagline;
    document.getElementById("privacyFooter").innerHTML = t.privacyFooter;
    document.getElementById("feature1").textContent = t.feature1;
    document.getElementById("feature2").textContent = t.feature2;
    document.getElementById("feature3").textContent = t.feature3;
    document.getElementById("feature4").textContent = t.feature4;
    document.getElementById("refTitle").textContent = t.refTitle;
    document.getElementById("footerText").textContent = t.footerText;
    
    if (!document.getElementById('screeningCard').classList.contains('hidden')) loadQuestion();
  }

  // ==========================================
  // START
  // ==========================================
  function startScreening() {
    gtag('event', 'screening_started', { 'event_category': 'engagement' });
    document.getElementById('heroCard').style.display = 'none';
    document.getElementById('aboutHeader').style.display = 'none';
    document.getElementById('aboutContent').style.display = 'none';
    document.getElementById('screeningCard').classList.remove('hidden');
    currentQuestion = 0; answers = {}; totalScore = 0;
    loadQuestion();
  }

  // ==========================================
  // LOAD QUESTION
  // ==========================================
  function loadQuestion() {
    var q = questions[currentQuestion];
    var lang = currentLang;
    
    var progress = ((currentQuestion + 1) / questions.length) * 100;
    document.getElementById('progressFill').style.width = progress + '%';
    document.getElementById('progressText').textContent = 'Question ' + (currentQuestion + 1) + ' of ' + questions.length;
    document.getElementById('questionText').textContent = q.text[lang];
    document.getElementById('visualHelper').innerHTML = '';
    document.getElementById('optionsContainer').innerHTML = '';
    
    if (q.helper) {
      document.getElementById('visualHelper').innerHTML = '<div class="visual-helper"><div class="visual-helper-text">' + q.helper[lang] + '</div></div>';
    }
    
    if (q.showFoodGallery) {
      document.getElementById('visualHelper').innerHTML += '<div class="food-gallery">' +
        '<div class="food-item"><div style="width:100%;height:60px;background:#4CAF50;border-radius:8px;margin-bottom:8px;display:flex;align-items:center;justify-content:center;font-size:28px;">ЁЯем</div><div class="food-item-name">Spinach<br>рдкрд╛рд▓рдХ/рдкрд╛рд▓рдХ</div></div>' +
        '<div class="food-item"><div style="width:100%;height:60px;background:#8D6E63;border-radius:8px;margin-bottom:8px;display:flex;align-items:center;justify-content:center;font-size:28px;">ЁЯлШ</div><div class="food-item-name">Pulses<br>рджрд╛рд▓/рдбрд╛рд│реА</div></div>' +
        '<div class="food-item"><div style="width:100%;height:60px;background:#6D4C41;border-radius:8px;margin-bottom:8px;display:flex;align-items:center;justify-content:center;font-size:28px;">ЁЯЯд</div><div class="food-item-name">Jaggery<br>рдЧреБрдбрд╝/рдЧреВрд│</div></div>' +
        '<div class="food-item"><div style="width:100%;height:60px;background:#FFF9C4;border-radius:8px;margin-bottom:8px;display:flex;align-items:center;justify-content:center;font-size:28px;">ЁЯеЪ</div><div class="food-item-name">Eggs<br>рдЕрдВрдбреЗ/рдЕрдВрдбреА</div></div>' +
      '</div>';
    }
    
    if (q.type === 'number') {
      document.getElementById('optionsContainer').innerHTML = '<input type="number" id="numberInput" min="' + q.min + '" max="' + q.max + '" placeholder="' + q.placeholder[lang] + '" style="width:100%;padding:14px;font-size:16px;border:2px solid #e0e0e0;border-radius:10px;" onchange="selectNumberAnswer()">';
      if (answers[q.id] !== undefined) document.getElementById('numberInput').value = answers[q.id];
    } else {
      var html = '';
      q.options.forEach(function(option, index) {
        var isSelected = answers[q.id] === index;
        html += '<div class="option-btn ' + (isSelected ? 'selected' : '') + '" onclick="selectAnswer(' + index + ',' + option.score + ')">' +
          '<span class="option-icon">' + option.text[lang].split(' ')[0] + '</span>' +
          '<span>' + option.text[lang].substring(option.text[lang].indexOf(' ') + 1) + '</span></div>';
      });
      document.getElementById('optionsContainer').innerHTML = html;
    }
    
    document.getElementById('prevBtn').disabled = currentQuestion === 0;
    document.getElementById('nextBtn').disabled = answers[q.id] === undefined;
    document.getElementById('nextBtn').textContent = currentQuestion === questions.length - 1 ? 'тЬУ Finish' : 'Next тЖТ';
  }

  // ==========================================
  // SELECT ANSWER
  // ==========================================
  function selectAnswer(index, score) {
    answers[questions[currentQuestion].id] = index;
    document.querySelectorAll('.option-btn').forEach(function(btn, i) {
      btn.classList.toggle('selected', i === index);
    });
    document.getElementById('nextBtn').disabled = false;
  }

  function selectNumberAnswer() {
    var q = questions[currentQuestion];
    var input = document.getElementById('numberInput');
    var value = parseInt(input.value);
    input.style.borderColor = '';
    
    if (isNaN(value) || value < q.min || value > q.max) {
      input.style.borderColor = '#ef4444';
      document.getElementById('nextBtn').disabled = true;
      if (!isNaN(value)) {
        alert(currentLang === 'en' ? 'Please enter age between ' + q.min + '-' + q.max :
              currentLang === 'hi' ? 'рдХреГрдкрдпрд╛ ' + q.min + '-' + q.max + ' рдХреЗ рдмреАрдЪ рдЙрдореНрд░ рджрд░реНрдЬ рдХрд░реЗрдВ' :
              'рдХреГрдкрдпрд╛ ' + q.min + '-' + q.max + ' рджрд░рдореНрдпрд╛рди рд╡рдп рдкреНрд░рд╡рд┐рд╖реНрдЯ рдХрд░рд╛');
      }
      return;
    }
    input.style.borderColor = '#4caf50';
    answers[q.id] = value;
    document.getElementById('nextBtn').disabled = false;
  }

  // ==========================================
  // NAVIGATION
  // ==========================================
  function nextQuestion() {
    if (currentQuestion < questions.length - 1) { currentQuestion++; loadQuestion(); }
    else calculateAndShowResult();
  }
  function previousQuestion() {
    if (currentQuestion > 0) { currentQuestion--; loadQuestion(); }
  }

  // ==========================================
  // CALCULATE RESULT
  // ==========================================
  function calculateAndShowResult() {
    totalScore = 0;
    var symptoms = 0;
    
    questions.forEach(function(q) {
      if (q.type === 'number') return;
      var answerIndex = answers[q.id];
      if (answerIndex !== undefined) {
        var score = q.options[answerIndex].score;
        totalScore += score;
        if (['fatigue','dizziness','breathless','headache'].indexOf(q.id) !== -1 && score > 0) symptoms++;
      }
    });
    
    var riskLevel = 'low';
    if (totalScore >= 8 || (answers.bleeding === 1 && symptoms >= 1)) riskLevel = 'high';
    else if (totalScore >= 4 || answers.pregnant === 1 || answers.postpartum === 1 || (answers.diet === 1 && symptoms >= 1)) riskLevel = 'moderate';
    
    gtag('event', 'screening_completed', { 'event_category': 'conversion', 'value': totalScore });
    gtag('event', 'risk_assessment', { 'event_category': 'assessment', 'risk_level': riskLevel, 'total_score': totalScore, 'symptoms_count': symptoms });
    
    var result = { score: totalScore, symptoms: symptoms, riskLevel: riskLevel, timestamp: new Date().toISOString() };
    safeLocalStorage('set', 'lastScreeningResult', JSON.stringify(result));
    displayResult(riskLevel, result);
  }

  // ==========================================
  // DISPLAY RESULT
  // ==========================================
  function displayResult(riskLevel, result) {
    document.getElementById('screeningCard').classList.add('hidden');
    var resultCard = document.getElementById('resultCard');
    resultCard.style.display = 'block';
    resultCard.className = 'result-card ' + riskLevel + '-risk';
    
    var lang = currentLang;
    var titles = { high: {en:'High Risk',hi:'рдЙрдЪреНрдЪ рдЬреЛрдЦрд┐рдо',mr:'рдЙрдЪреНрдЪ рдЬреЛрдЦреАрдо'}, moderate: {en:'Moderate Risk',hi:'рдордзреНрдпрдо рдЬреЛрдЦрд┐рдо',mr:'рдордзреНрдпрдо рдЬреЛрдЦреАрдо'}, low: {en:'Low Risk',hi:'рдХрдо рдЬреЛрдЦрд┐рдо',mr:'рдХрдореА рдЬреЛрдЦреАрдо'} };
    var icons = { high:'ЁЯФ┤', moderate:'ЁЯЯб', low:'ЁЯЯв' };
    document.getElementById('resultTitle').innerHTML = icons[riskLevel] + ' ' + titles[riskLevel][lang];
    
    var texts = {
      high: {en:'Based on your responses, you may be at higher risk of anemia. Please take immediate action.',hi:'рдЖрдкрдХреЗ рдЙрддреНрддрд░реЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЖрдкрдХреЛ рдПрдиреАрдорд┐рдпрд╛ рдХрд╛ рдЕрдзрд┐рдХ рдЬреЛрдЦрд┐рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдХреГрдкрдпрд╛ рддрддреНрдХрд╛рд▓ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░реЗрдВред',mr:'рддреБрдордЪреНрдпрд╛ рдЙрддреНрддрд░рд╛рдВрд╡рд░ рдЖрдзрд╛рд░рд┐рдд, рддреБрдореНрд╣рд╛рд▓рд╛ рдЕреЕрдирд┐рдорд┐рдпрд╛рдЪрд╛ рдЬрд╛рд╕реНрдд рдзреЛрдХрд╛ рдЕрд╕реВ рд╢рдХрддреЛ. рдХреГрдкрдпрд╛ рддрд╛рддреНрдХрд╛рд│ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рд╛.'},
      moderate: {en:'Your responses suggest moderate risk factors for anemia. Consider getting tested soon.',hi:'рдЖрдкрдХреЗ рдЙрддреНрддрд░ рдПрдиреАрдорд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдордзреНрдпрдо рдЬреЛрдЦрд┐рдо рдХрд╛рд░рдХреЛрдВ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддреЗ рд╣реИрдВред',mr:'рддреБрдордЪреА рдЙрддреНрддрд░реЗ рдЕреЕрдирд┐рдорд┐рдпрд╛рд╕рд╛рдареА рдордзреНрдпрдо рдЬреЛрдЦреАрдо рдШрдЯрдХ рд╕реВрдЪрд┐рдд рдХрд░рддрд╛рдд.'},
      low: {en:'No major anemia risk indicators identified. Keep maintaining good health!',hi:'рдХреЛрдИ рдкреНрд░рдореБрдЦ рдПрдиреАрдорд┐рдпрд╛ рдЬреЛрдЦрд┐рдо рд╕рдВрдХреЗрддрдХ рдирд╣реАрдВ рдкрд╛рдпрд╛ рдЧрдпрд╛ред',mr:'рдХреЛрдгрддреЗрд╣реА рдкреНрд░рдореБрдЦ рдЕреЕрдирд┐рдорд┐рдпрд╛ рдЬреЛрдЦреАрдо рд╕реВрдЪрдХ рдЖрдврд│рд▓реЗ рдирд╛рд╣реАрдд.'}
    };
    document.getElementById('resultText').innerHTML = texts[riskLevel][lang];
    
    // Next steps content
    var steps = {
      high: {en:'<p><strong>тЪая╕П URGENT:</strong> Visit the nearest PHC within 7 days for hemoglobin (Hb) blood test.</p><p><strong>ЁЯН╜я╕П Dietary Changes:</strong></p><ul style="margin-left:20px;"><li>Eat iron-rich foods daily (spinach, pulses, jaggery, meat/eggs)</li><li>Add vitamin C with meals (lemon, amla, citrus fruits)</li><li>Avoid tea/coffee for 1 hour after meals</li></ul>',
           hi:'<p><strong>тЪая╕П рддрддреНрдХрд╛рд▓:</strong> рд╣реАрдореЛрдЧреНрд▓реЛрдмрд┐рди рд░рдХреНрдд рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП 7 рджрд┐рдиреЛрдВ рдХреЗ рднреАрддрд░ рдирд┐рдХрдЯрддрдо PHC рдкрд░ рдЬрд╛рдПрдВред</p><p><strong>ЁЯН╜я╕П рдЖрд╣рд╛рд░ рдкрд░рд┐рд╡рд░реНрддрди:</strong></p><ul style="margin-left:20px;"><li>рд░реЛрдЬрд╝ рдЖрдпрд░рди рдпреБрдХреНрдд рдЦрд╛рджреНрдп рдкрджрд╛рд░реНрде рдЦрд╛рдПрдВ</li><li>рднреЛрдЬрди рдХреЗ рд╕рд╛рде рд╡рд┐рдЯрд╛рдорд┐рди рд╕реА рд▓реЗрдВ</li><li>рднреЛрдЬрди рдХреЗ 1 рдШрдВрдЯреЗ рдмрд╛рдж рддрдХ рдЪрд╛рдп/рдХреЙрдлреА рд╕реЗ рдмрдЪреЗрдВ</li></ul>',
           mr:'<p><strong>тЪая╕П рддрд╛рддрдбреАрдЪреЗ:</strong> рд╣рд┐рдореЛрдЧреНрд▓реЛрдмрд┐рди рд░рдХреНрдд рдЪрд╛рдЪрдгреАрд╕рд╛рдареА 7 рджрд┐рд╡рд╕рд╛рдВрдд рдЬрд╡рд│рдЪреНрдпрд╛ PHC рд▓рд╛ рднреЗрдЯ рджреНрдпрд╛ред</p><p><strong>ЁЯН╜я╕П рдЖрд╣рд╛рд░ рдмрджрд▓:</strong></p><ul style="margin-left:20px;"><li>рд░реЛрдЬ рдЖрдпрд░реНрди-рд╕рдореГрджреНрдз рдкрджрд╛рд░реНрде рдЦрд╛</li><li>рдЬреЗрд╡рдгрд╛рд╕реЛрдмрдд рд╡реНрд╣рд┐рдЯреЕрдорд┐рди рд╕реА рдШреНрдпрд╛</li><li>рдЬреЗрд╡рдгрд╛рдирдВрддрд░ 1 рддрд╛рд╕рд╛рд╕рд╛рдареА рдЪрд╣рд╛/рдХреЙрдлреА рдЯрд╛рд│рд╛</li></ul>'},
      moderate: {en:'<p><strong>ЁЯУЛ Recommendation:</strong> Get hemoglobin test within 2-4 weeks.</p><p><strong>ЁЯеЧ Dietary Improvement:</strong></p><ul style="margin-left:20px;"><li>Eat iron-rich foods 4-5 times per week</li><li>Include vitamin C foods to improve absorption</li><li>Limit tea/coffee after meals</li></ul>',
                 hi:'<p><strong>ЁЯУЛ рд╕рд┐рдлрд╛рд░рд┐рд╢:</strong> 2-4 рд╕рдкреНрддрд╛рд╣ рдХреЗ рднреАрддрд░ рд╣реАрдореЛрдЧреНрд▓реЛрдмрд┐рди рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВред</p><p><strong>ЁЯеЧ рдЖрд╣рд╛рд░ рд╕реБрдзрд╛рд░:</strong></p><ul style="margin-left:20px;"><li>рд╕рдкреНрддрд╛рд╣ рдореЗрдВ 4-5 рдмрд╛рд░ рдЖрдпрд░рди рдпреБрдХреНрдд рдЦрд╛рджреНрдп рдкрджрд╛рд░реНрде рдЦрд╛рдПрдВ</li><li>рд╡рд┐рдЯрд╛рдорд┐рди рд╕реА рдЦрд╛рджреНрдп рдкрджрд╛рд░реНрде рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ</li></ul>',
                 mr:'<p><strong>ЁЯУЛ рд╢рд┐рдлрд╛рд░рд╕:</strong> 2-4 рдЖрдард╡рдбреНрдпрд╛рдВрдд рд╣рд┐рдореЛрдЧреНрд▓реЛрдмрд┐рди рдЪрд╛рдЪрдгреА рдХрд░рд╛ред</p><p><strong>ЁЯеЧ рдЖрд╣рд╛рд░ рд╕реБрдзрд╛рд░рдгрд╛:</strong></p><ul style="margin-left:20px;"><li>рдЖрдард╡рдбреНрдпрд╛рддреВрди 4-5 рд╡реЗрд│рд╛ рдЖрдпрд░реНрди-рд╕рдореГрджреНрдз рдкрджрд╛рд░реНрде рдЦрд╛</li><li>рд╡реНрд╣рд┐рдЯреЕрдорд┐рди рд╕реА рдкрджрд╛рд░реНрде рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдХрд░рд╛</li></ul>'},
      low: {en:'<p><strong>тЬЕ Advice:</strong> Continue eating a balanced iron-rich diet and get annual health check-ups.</p><p><strong>ЁЯМЯ Preventive Care:</strong></p><ul style="margin-left:20px;"><li>Maintain variety in iron-rich foods</li><li>Stay hydrated (8-10 glasses daily)</li><li>Repeat screening after 6 months</li></ul>',
            hi:'<p><strong>тЬЕ рд╕рд▓рд╛рд╣:</strong> рд╕рдВрддреБрд▓рд┐рдд рдЖрдпрд░рди рдпреБрдХреНрдд рдЖрд╣рд╛рд░ рдЬрд╛рд░реА рд░рдЦреЗрдВред</p><p><strong>ЁЯМЯ рдирд┐рд╡рд╛рд░рдХ рджреЗрдЦрднрд╛рд▓:</strong></p><ul style="margin-left:20px;"><li>рдЖрдпрд░рди рдпреБрдХреНрдд рдЦрд╛рджреНрдп рдкрджрд╛рд░реНрдереЛрдВ рдореЗрдВ рд╡рд┐рд╡рд┐рдзрддрд╛ рдмрдирд╛рдП рд░рдЦреЗрдВ</li><li>рд╣рд╛рдЗрдбреНрд░реЗрдЯреЗрдб рд░рд╣реЗрдВ</li><li>6 рдорд╣реАрдиреЗ рдмрд╛рдж рдлрд┐рд░ рд╕реЗ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ</li></ul>',
            mr:'<p><strong>тЬЕ рд╕рд▓реНрд▓рд╛:</strong> рд╕рдВрддреБрд▓рд┐рдд рдЖрдпрд░реНрди-рд╕рдореГрджреНрдз рдЖрд╣рд╛рд░ рд╕реБрд░реВ рдареЗрд╡рд╛ред</p><p><strong>ЁЯМЯ рдкреНрд░рддрд┐рдмрдВрдзрд╛рддреНрдордХ рдХрд╛рд│рдЬреА:</strong></p><ul style="margin-left:20px;"><li>рдЖрдпрд░реНрди-рд╕рдореГрджреНрдз рдкрджрд╛рд░реНрдерд╛рдВрдордзреНрдпреЗ рд╡рд┐рд╡рд┐рдзрддрд╛ рд░рд╛рдЦрд╛</li><li>рд╣рд╛рдпрдбреНрд░реЗрдЯреЗрдб рд░рд╛рд╣рд╛</li><li>6 рдорд╣рд┐рдиреНрдпрд╛рдВрдирдВрддрд░ рдкреБрдиреНрд╣рд╛ рддрдкрд╛рд╕рдгреА рдХрд░рд╛</li></ul>'}
    };
    document.getElementById('nextStepsContent').innerHTML = steps[riskLevel][lang];
    
    // Update translated labels
    var t = translations[lang];
    document.getElementById('nextStepsTitle').textContent = t.nextStepsTitle;
    document.getElementById('healthResourcesTitle').textContent = t.healthResourcesTitle;
    document.getElementById('phcFinderTitle').textContent = t.phcFinderTitle;
    document.getElementById('findPHCLink').textContent = t.findPHCLink;
    document.getElementById('showPHCBtn').textContent = t.showPHCBtn;
    document.getElementById('btnWhatsApp').textContent = t.btnWhatsApp;
    document.getElementById('btnPrint').textContent = t.btnPrint;
    document.getElementById('btnSave').textContent = t.btnSave;
    document.getElementById('btnReset').textContent = t.btnReset;
    document.getElementById('progressTrackerTitle').textContent = t.progressTrackerTitle;
    document.getElementById('btnCopyCode').textContent = t.btnCopyCode;
    document.getElementById('challengeTitle').textContent = t.challengeTitle;
    document.getElementById('goal1').textContent = t.goal1;
    document.getElementById('goal2').textContent = t.goal2;
    document.getElementById('goal3').textContent = t.goal3;
    document.getElementById('goal4').textContent = t.goal4;
    document.getElementById('streakLabel').textContent = t.streakLabel;
    document.getElementById('learnMoreTitle').textContent = t.learnMoreTitle;
    
    document.getElementById('referencesCard').style.display = 'block';
    
    // FIX 2: Progress code persists across visits
    var progressCode = generateProgressCode();
    document.getElementById('progressCode').textContent = progressCode;
    document.getElementById('progressCodeDateValue').textContent = new Date().toLocaleDateString();
    
    // Load challenge (restores checkboxes properly)
    loadChallengeData();
    
    resultCard.scrollIntoView({ behavior: 'smooth' });
  }

  // ==========================================
  // PHC FINDER
  // ==========================================
  function findNearestPHC() {
    gtag('event', 'phc_finder_used', { 'event_category': 'engagement' });
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(pos) {
        window.open('https://www.google.com/maps/search/Primary+Health+Centre/@' + pos.coords.latitude + ',' + pos.coords.longitude + ',14z', '_blank');
      }, function() {
        alert('Please enable location services or use the dropdown below.');
      });
    } else {
      alert('Geolocation not supported. Please use the dropdown below.');
    }
  }

  function loadDistricts() {
    var state = document.getElementById('stateSelect').value;
    var districts = {
      maharashtra:['Mumbai','Mumbai Suburban','Thane','Raigad','Ratnagiri','Sindhudurg','Pune','Satara','Sangli','Solapur','Kolhapur','Nashik','Dhule','Nandurbar','Jalgaon','Aurangabad','Jalna','Beed','Latur','Osmanabad','Nanded','Parbhani','Hingoli','Nagpur','Wardha','Amravati','Akola','Yavatmal','Buldhana','Washim','Chandrapur','Gadchiroli','Bhandara','Gondia'],
      gujarat:['Ahmedabad','Surat','Vadodara','Rajkot','Gandhinagar','Bhavnagar','Jamnagar'],
      karnataka:['Bangalore','Mysore','Mangalore','Hubli','Belgaum','Gulbarga'],
      delhi:['Central Delhi','North Delhi','South Delhi','East Delhi','West Delhi','New Delhi'],
      up:['Lucknow','Kanpur','Ghaziabad','Agra','Varanasi','Meerut','Prayagraj','Noida'],
      mp:['Bhopal','Indore','Jabalpur','Gwalior','Ujjain','Sagar','Ratlam']
    };
    var sel = document.getElementById('districtSelect');
    sel.innerHTML = '<option value="">Select Your District</option>';
    if (state && districts[state]) {
      districts[state].forEach(function(d) { sel.innerHTML += '<option value="' + d + '">' + d + '</option>'; });
    }
  }

  function showPHCContacts() {
    var state = document.getElementById('stateSelect').value;
    var district = document.getElementById('districtSelect').value;
    if (!state || !district) { alert('Please select both state and district'); return; }
    var div = document.getElementById('phcResults');
    div.innerHTML = '<div style="background:white;padding:12px;border-radius:8px;border:2px solid #4caf50;"><strong>ЁЯУН ' + district + ' PHC Information</strong><br><small style="color:#666;">Contact your nearest PHC for hemoglobin testing</small><br><br><a href="https://www.google.com/maps/search/Primary+Health+Centre+' + district + '" target="_blank" rel="noopener noreferrer" style="color:#2196f3;text-decoration:none;font-weight:600;">ЁЯЧ║я╕П View ' + district + ' PHCs on Google Maps</a></div>';
    div.style.display = 'block';
  }

  // ==========================================
  // SHARE / SAVE / PRINT
  // ==========================================
  function shareWhatsApp() {
    var resultData = safeLocalStorage('get', 'lastScreeningResult');
    if (!resultData) { alert('No result found. Please complete screening first.'); return; }
    var result;
    try { result = JSON.parse(resultData); } catch(e) { alert('Error. Please try screening again.'); return; }
    
    var lang = currentLang;
    var riskLabels = { high:{en:'ЁЯФ┤ HIGH RISK',hi:'ЁЯФ┤ рдЙрдЪреНрдЪ рдЬреЛрдЦрд┐рдо',mr:'ЁЯФ┤ рдЙрдЪреНрдЪ рдЬреЛрдЦреАрдо'}, moderate:{en:'ЁЯЯб MODERATE RISK',hi:'ЁЯЯб рдордзреНрдпрдо рдЬреЛрдЦрд┐рдо',mr:'ЁЯЯб рдордзреНрдпрдо рдЬреЛрдЦреАрдо'}, low:{en:'ЁЯЯв LOW RISK',hi:'ЁЯЯв рдХрдо рдЬреЛрдЦрд┐рдо',mr:'ЁЯЯв рдХрдореА рдЬреЛрдЦреАрдо'} };
    var msg = '*AAROGYA LINK*\nЁЯУЕ ' + new Date().toLocaleDateString() + '\nтЪХя╕П ' + riskLabels[result.riskLevel][lang] + '\nЁЯУК Score: ' + result.score + '/15\n\nЁЯй║ Rotaract Club of D.Y. Patil SBB\nЁЯМР https://aarogyalink.org\n\nтЪая╕П This is a screening tool, not a diagnosis.';
    
    window.open('https://wa.me/?text=' + encodeURIComponent(msg), '_blank');
    gtag('event', 'share', { 'event_category': 'engagement', 'method': 'WhatsApp' });
  }

  function printResults() { window.print(); }

  function saveResults() {
    var resultData = safeLocalStorage('get', 'lastScreeningResult');
    if (!resultData) { alert('No result found.'); return; }
    var result;
    try { result = JSON.parse(resultData); } catch(e) { alert('Error loading results.'); return; }
    
    var content = 'AAROGYA LINK - Screening Result\n' +
      '================================\nDate: ' + new Date().toLocaleDateString() +
      '\nRisk Level: ' + result.riskLevel.toUpperCase() +
      '\nScore: ' + result.score + '/15' +
      '\nSymptoms: ' + result.symptoms +
      '\n\nтЪая╕П This is a screening tool, not a medical diagnosis.\n' +
      'Always consult healthcare professionals.\n\n' +
      'National Health Helpline: 104\nWomen Helpline: 1091\nEmergency: 108\n\n' +
      'Developed by Rotaract Club of D.Y. Patil SBB, Navi Mumbai';
    
    var blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url; a.download = 'Aarogya-Link-Result.txt'; a.click();
    URL.revokeObjectURL(url);
    alert(currentLang === 'en' ? 'Result saved!' : currentLang === 'hi' ? 'рдкрд░рд┐рдгрд╛рдо рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛!' : 'рдкрд░рд┐рдгрд╛рдо рдЬрддрди рдХреЗрд▓рд╛!');
    gtag('event', 'download', { 'event_category': 'engagement' });
  }

  function resetScreening() {
    document.getElementById('resultCard').style.display = 'none';
    document.getElementById('heroCard').style.display = 'block';
    document.getElementById('aboutHeader').style.display = 'flex';
    document.getElementById('screeningCard').classList.add('hidden');
    currentQuestion = 0; answers = {}; totalScore = 0;
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // ==========================================
  // FIX 2: PROGRESS CODE тАФ persists in localStorage
  // ==========================================
  function generateProgressCode() {
    var existing = safeLocalStorage('get', 'aarogya_progress_code');
    if (existing) return existing;
    var code = 'AH-' + Math.floor(1000 + Math.random() * 9000);
    safeLocalStorage('set', 'aarogya_progress_code', code);
    return code;
  }

  // FIX 1: 'this' is passed from onclick, no reliance on global event
  function copyProgressCode(btn) {
    var code = document.getElementById('progressCode').textContent;
    var span = document.getElementById('btnCopyCode');
    var originalText = span ? span.textContent : 'Copy Progress Code';

    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(code).then(function() {
        if (span) span.textContent = 'тЬЕ Copied!';
        setTimeout(function() { if (span) span.textContent = originalText; }, 2000);
        gtag('event', 'copy_progress_code', { 'event_category': 'engagement' });
      }).catch(function() {
        fallbackCopy(code);
      });
    } else {
      fallbackCopy(code);
    }
  }

  // Fallback for browsers without clipboard API
  function fallbackCopy(code) {
    var ta = document.createElement('textarea');
    ta.value = code;
    ta.style.position = 'fixed';
    ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand('copy'); } catch(e) {}
    document.body.removeChild(ta);
    var span = document.getElementById('btnCopyCode');
    if (span) {
      var orig = span.textContent;
      span.textContent = 'тЬЕ Copied!';
      setTimeout(function() { span.textContent = orig; }, 2000);
    }
    gtag('event', 'copy_progress_code', { 'event_category': 'engagement', 'method': 'fallback' });
  }

  // ==========================================
  // FIX 3 + 5: 21-DAY CHALLENGE тАФ safe dates, persist checkboxes
  // ==========================================
  function updateChallenge() {
    var checkboxes = document.querySelectorAll('#dailyGoals input[type="checkbox"]');
    var todayStr = getTodayStr();
    
    var completedToday = 0;
    checkboxes.forEach(function(cb) { if (cb.checked) completedToday++; });

    // FIX 5: Save checkbox states immediately on every change
    var states = [];
    checkboxes.forEach(function(cb) { states.push(cb.checked); });
    safeLocalStorage('set', 'challenge_checkboxes_' + todayStr, JSON.stringify(states));

    var challengeData = safeLocalStorage('get', 'challenge_data');
    var data = { streak: 0, lastUpdate: '', history: [] };
    if (challengeData) { try { data = JSON.parse(challengeData); } catch(e) {} }

    if (completedToday === 4) {
      if (data.lastUpdate !== todayStr) {
        // FIX 3: Safe date comparison using YYYY-M-D format
        var diffDays = 999;
        if (data.lastUpdate) {
          var parts = data.lastUpdate.split('-');
          if (parts.length === 3) {
            var lastDate = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
            var today = new Date();
            var currentDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            diffDays = Math.round((currentDate - lastDate) / (1000 * 60 * 60 * 24));
          }
        }
        
        if (diffDays === 1) data.streak++;
        else if (diffDays > 1) data.streak = 1;
        else data.streak = data.streak || 1;
        
        data.lastUpdate = todayStr;
        data.history.push({ date: todayStr, completed: 4 });
        safeLocalStorage('set', 'challenge_data', JSON.stringify(data));
      }
    }
    
    updateChallengeUI(data.streak, completedToday);
    if (completedToday === 4) gtag('event', 'challenge_day_completed', { 'event_category': 'engagement', 'value': data.streak });
  }

  function updateChallengeUI(streak, completedToday) {
    document.getElementById('streakDisplay').textContent = 'ЁЯФе ' + streak;
    var lang = currentLang;
    var msg = '';
    if (streak === 0) msg = lang === 'en' ? 'Complete all 4 goals today to start your streak!' : lang === 'hi' ? 'рдЖрдЬ рд╕рднреА 4 рд▓рдХреНрд╖реНрдп рдкреВрд░реЗ рдХрд░реЗрдВ!' : 'рдЖрдЬ рд╕рд░реНрд╡ 4 рдзреНрдпреЗрдпреЗ рдкреВрд░реНрдг рдХрд░рд╛!';
    else if (streak < 7) msg = lang === 'en' ? 'Great start! ' + completedToday + '/4 today' : lang === 'hi' ? 'рдмрдврд╝рд┐рдпрд╛! рдЖрдЬ ' + completedToday + '/4' : 'рдЙрддреНрддрдо! рдЖрдЬ ' + completedToday + '/4';
    else if (streak < 14) msg = lang === 'en' ? 'Amazing! Week ' + Math.floor(streak/7) + ' done!' : lang === 'hi' ? 'рд╕рдкреНрддрд╛рд╣ ' + Math.floor(streak/7) + ' рдкреВрд░рд╛!' : 'рдЖрдард╡рдбрд╛ ' + Math.floor(streak/7) + ' рдкреВрд░реНрдг!';
    else if (streak < 21) msg = lang === 'en' ? (21-streak) + ' days to go!' : lang === 'hi' ? (21-streak) + ' рджрд┐рди рдмрд╛рдХреА!' : (21-streak) + ' рджрд┐рд╡рд╕ рдмрд╛рдХреА!';
    else msg = lang === 'en' ? 'ЁЯОЙ 21-Day Challenge Complete!' : lang === 'hi' ? 'ЁЯОЙ рдЪреБрдиреМрддреА рдкреВрд░реА!' : 'ЁЯОЙ рдЖрд╡реНрд╣рд╛рди рдкреВрд░реНрдг!';
    document.getElementById('streakMotivation').textContent = msg;
  }

  // FIX 5: Restore checkboxes from per-day storage (not just when all 4 done)
  function loadChallengeData() {
    var todayStr = getTodayStr();
    var savedStates = safeLocalStorage('get', 'challenge_checkboxes_' + todayStr);
    if (savedStates) {
      try {
        var states = JSON.parse(savedStates);
        var checkboxes = document.querySelectorAll('#dailyGoals input[type="checkbox"]');
        checkboxes.forEach(function(cb, i) { if (states[i]) cb.checked = true; });
      } catch(e) { console.error('checkbox restore failed', e); }
    }

    var challengeData = safeLocalStorage('get', 'challenge_data');
    if (challengeData) {
      try {
        var data = JSON.parse(challengeData);
        updateChallengeUI(data.streak, 0);
      } catch(e) {}
    }
  }

  // ==========================================
  // FIX 4: ARTICLES тАФ no optional chaining, explicit fallback
  // ==========================================
  var articles = {
    en: {
      article1: '<strong>Iron-Rich Breakfast Ideas:</strong><br><br><strong>1. Spinach Paratha with Curd</strong><br>Mix chopped spinach in whole wheat dough. Serve with curd and lemon for vitamin C boost.<br><br><strong>2. Moong Dal Cheela</strong><br>Protein-packed pancakes from moong dal. Add onions and tomatoes. Serve with green chutney.<br><br><strong>3. Ragi Porridge with Jaggery</strong><br>Cook ragi flour with milk. Sweeten with jaggery (iron-rich). Add dry fruits.<br><br><strong>4. Egg Bhurji with Whole Wheat Toast</strong><br>Scrambled eggs with tomatoes and onions on whole grain bread. Add orange juice.<br><br><strong>5. Poha with Peanuts and Lemon</strong><br>Traditional poha loaded with peanuts (iron) and fresh lemon juice (vitamin C).<br><br><strong>ЁЯТб Pro Tip:</strong> Always add lemon or amla to iron-rich meals тАФ vitamin C helps your body absorb iron better!',

      article2: '<strong>The Tea-Iron Connection:</strong><br><br>Tea and coffee contain compounds called <strong>tannins</strong> and <strong>polyphenols</strong>. These bind with iron in your digestive system and prevent your body from absorbing it.<br><br><strong>What happens:</strong><br>тАв You eat dal or spinach (rich in iron)<br>тАв Drink tea right after<br>тАв Tannins bind to the iron<br>тАв Your body absorbs only 25-30% instead of 60-70%<br><br><strong>Simple Solution:</strong><br>Wait at least 1 hour after meals before drinking tea or coffee.<br><br><strong>Better Options Right After Meals:</strong><br>тЬЕ Plain water<br>тЬЕ Buttermilk<br>тЬЕ Lemon water<br>тЬЕ Fresh fruit juice (vitamin C boost!)<br><br><strong>ЁЯТб Cultural Tip:</strong> Many grandmothers were right тАФ now science confirms why!',

      article3: '<strong>Warning Signs тАФ Visit PHC if You Experience:</strong><br><br><strong>ЁЯЪи URGENT (Visit Today):</strong><br>тАв Extreme weakness тАФ cannot stand or walk<br>тАв Fainting or near-fainting episodes<br>тАв Chest pain or rapid heartbeat<br>тАв Severe breathlessness even at rest<br>тАв Pale skin with blue lips or nails<br><br><strong>тЪая╕П WITHIN 3-7 DAYS:</strong><br>тАв Constant tiredness for 2+ weeks<br>тАв Dizziness when standing up<br>тАв Frequent headaches<br>тАв Soaking pad every 1-2 hours during periods<br><br><strong>ЁЯУЛ PLAN A VISIT (Within 2-4 Weeks):</strong><br>тАв Mild fatigue<br>тАв Occasional dizziness<br>тАв Poor appetite<br>тАв Pregnant or recently delivered<br><br><strong>ЁЯТб Remember:</strong> Getting tested is free at PHCs. Do not wait until it gets worse!',

      article4: '<strong>Understanding Hemoglobin Levels:</strong><br><br><strong>What is Hemoglobin (Hb)?</strong><br>Hemoglobin is a protein in red blood cells that carries oxygen. When it is low, you have anemia.<br><br><strong>Normal Levels for Women (15-49 years):</strong><br>тЬЕ <strong>Normal:</strong> 12.0 g/dL or higher<br>ЁЯЯб <strong>Mild Anemia:</strong> 11.0-11.9 g/dL<br>ЁЯЯа <strong>Moderate Anemia:</strong> 8.0-10.9 g/dL<br>ЁЯФ┤ <strong>Severe Anemia:</strong> Below 8.0 g/dL<br><br><strong>During Pregnancy:</strong><br>Normal drops slightly to 11.0 g/dL or higher.<br><br><strong>ЁЯТб Good to Know:</strong> Your hemoglobin can improve 1-2 g/dL in just 3-4 weeks with proper diet and supplements!',

      article5: '<strong>Natural Ways to Boost Energy:</strong><br><br><strong>1. Jaggery Water in Morning</strong><br>Mix 1 small piece of jaggery in warm water. Drink on empty stomach.<br><br><strong>2. Amla (Indian Gooseberry)</strong><br>Eat 1-2 fresh amla daily. Super high in vitamin C тАФ helps iron absorption.<br><br><strong>3. Beetroot Juice</strong><br>Blend 1 small beetroot with carrot and apple. Natural blood builder.<br><br><strong>4. Dates and Milk</strong><br>Soak 2-3 dates overnight in milk. Eat in morning. Iron + calcium + energy.<br><br><strong>5. Sesame Seeds (Til)</strong><br>Add roasted sesame to food. Excellent iron source.<br><br><strong>6. Deep Breathing (Pranayama)</strong><br>5 minutes of deep breathing improves oxygen circulation.<br><br><strong>7. Tulsi Tea</strong><br>Boil tulsi leaves in water. No tannins тАФ does not block iron.<br><br><strong>ЁЯТб Consistency is Key:</strong> These work best when done daily for 3-4 weeks!'
    }
  };

  // FIX 4: No optional chaining тАФ explicit check works on all browsers
  function toggleArticle(articleId) {
    var content = document.getElementById(articleId);
    var arrow = document.getElementById(articleId + 'Arrow');
    var lang = currentLang;

    if (content.style.display === 'none') {
      var articleText = (articles[lang] && articles[lang][articleId]) ? articles[lang][articleId] : articles['en'][articleId];
      content.innerHTML = articleText || '<p>Content loading...</p>';
      content.style.display = 'block';
      arrow.textContent = 'тЦ▓';
      gtag('event', 'article_opened', { 'event_category': 'engagement', 'event_label': articleId });
    } else {
      content.style.display = 'none';
      arrow.textContent = 'тЦ╝';
    }
  }

  // ==========================================
  // INIT
  // ==========================================
  window.addEventListener('load', function() {
    var savedLang = safeLocalStorage('get', 'preferredLanguage') || 'en';
    if (savedLang !== 'en') setLang(savedLang);
  });
</script>

</body>
</html>
